{
  "master": {
    "tasks": [
      {
        "id": 1,
        "title": "Project Initialization & Architecture Setup",
        "description": "Initialize the React application, configure the directory structure, and set up the global state management system.",
        "details": "Initialize a modern React application. Set up the folder structure as defined in the PRD (components/SectorMap, components/FactionManager, etc.). Install core dependencies: Redux Toolkit, React Query, Immer, Framer Motion, and D3.js/Hexagon.js. Configure the Redux store with initial empty slices for 'sector' and 'factions'. Implement a basic layout shell with a dark theme default.",
        "testStrategy": "Verify the application builds and runs without errors. Check Redux DevTools to ensure the store is initialized. Verify directory structure matches the PRD specifications.",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Initialize React Application with TypeScript",
            "description": "Scaffold the base React application using a modern build tool like Vite with TypeScript support.",
            "dependencies": [],
            "details": "Run the initialization command (e.g., `npm create vite@latest`), configure `tsconfig.json` for strict mode, and set up ESLint and Prettier for code quality enforcement. Ensure the development server runs successfully.\n<info added on 2025-11-23T17:47:24.278Z>\nSuccessfully initialized React application with Vite and TypeScript. Configured strict mode in tsconfig.app.json. Set up ESLint with TypeScript support and Prettier for code formatting. Verified dev server runs successfully.\n</info added on 2025-11-23T17:47:24.278Z>",
            "status": "done",
            "testStrategy": "Run `npm run dev` and verify the default landing page loads without console errors."
          },
          {
            "id": 2,
            "title": "Install Core Project Dependencies",
            "description": "Install all required third-party libraries defined in the technical specifications.",
            "dependencies": [
              1
            ],
            "details": "Execute installation commands for `@reduxjs/toolkit`, `react-redux`, `@tanstack/react-query`, `immer`, `framer-motion`, `d3`, and `hexagon-js` (or equivalent hex library). Verify `package.json` reflects these additions.\n<info added on 2025-11-23T17:47:33.931Z>\nInstalled all core dependencies: @reduxjs/toolkit, react-redux, @tanstack/react-query, immer, framer-motion, d3, and honeycomb-grid (for hex grid rendering). Verified build completes successfully with no version conflicts.\n</info added on 2025-11-23T17:47:33.931Z>",
            "status": "done",
            "testStrategy": "Check `package.json` for presence of all libraries and run a build to ensure no version conflicts exist."
          },
          {
            "id": 3,
            "title": "Establish Directory Structure",
            "description": "Create the folder hierarchy to organize components, state, and utilities as per the PRD.",
            "dependencies": [
              1
            ],
            "details": "Create the following directory paths: `src/components/SectorMap`, `src/components/FactionManager`, `src/store`, `src/services`, `src/hooks`, and `src/types`. Move any default assets to their appropriate locations.\n<info added on 2025-11-23T17:47:45.297Z>\nCreated complete directory structure matching PRD specifications: src/components/SectorMap, src/components/FactionManager, src/store, src/services, src/hooks, and src/types. Verified application still compiles after directory creation.\n</info added on 2025-11-23T17:47:45.297Z>",
            "status": "done",
            "testStrategy": "Verify the file tree matches the PRD structure and that the application still compiles after moving default files."
          },
          {
            "id": 4,
            "title": "Configure Redux Store and Slices",
            "description": "Set up the global state management system using Redux Toolkit with initial slices.",
            "dependencies": [
              2,
              3
            ],
            "details": "Create `store.ts` in the store directory. Implement initial empty slices for `sectorSlice` and `factionsSlice`. Configure the root reducer and wrap the main application entry point (`main.tsx` or `index.tsx`) with the Redux `<Provider>`.\n<info added on 2025-11-23T17:47:59.236Z>\nConfigured Redux store with initial empty slices for 'sector' and 'factions'. Wrapped application with Redux Provider in main.tsx. Verified Redux DevTools will be able to see the store structure. All TypeScript strict mode requirements satisfied.\n</info added on 2025-11-23T17:47:59.236Z>",
            "status": "done",
            "testStrategy": "Open Redux DevTools in the browser and verify that the store is active and the 'sector' and 'factions' slices are visible in the state tree."
          },
          {
            "id": 5,
            "title": "Implement Application Layout Shell",
            "description": "Create the main application wrapper with a persistent layout and dark theme configuration.",
            "dependencies": [
              3
            ],
            "details": "Develop a `MainLayout` component that serves as the application shell. Configure global CSS variables or Tailwind config for a dark theme (backgrounds, text colors). Render a placeholder header and main content area.\n<info added on 2025-11-23T17:48:07.898Z>\nCreated MainLayout component with header and main content area. Configured dark theme using CSS variables (--bg-primary, --text-primary, etc.) for easy customization. Updated global styles for consistent dark theme appearance. Layout structure verified visually and functionally.\n</info added on 2025-11-23T17:48:07.898Z>",
            "status": "done",
            "testStrategy": "Visually inspect the application to ensure the background is dark and the layout structure (header/main) is rendered correctly."
          }
        ]
      },
      {
        "id": 2,
        "title": "Procedural Sector Generation Logic",
        "description": "Implement the core algorithms for generating the stellar sector, systems, and worlds without the UI.",
        "details": "Create a utility service for generation. Implement the 8x10 hexagonal grid logic. Develop the algorithm to place 21-30 star systems. Implement Spike Route generation logic based on metadimensional proximity and drive ratings (1-6). Create the World Generation logic using Faker.js for names and RNG for attributes (Atmosphere, Temperature, Biosphere, Population, Tech Level, Government). Assign 2 World Tags per system. Output must match the 'Sector Schema' defined in the PRD.",
        "testStrategy": "Unit test the generator function to ensure it always produces between 21-30 systems. Verify that every system has a valid route connection (no orphans). Validate data types against the Sector Schema.",
        "priority": "high",
        "dependencies": [
          1
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement Hex Grid and Star Placement Algorithm",
            "description": "Define the coordinate system and randomly place star systems within the grid bounds.",
            "dependencies": [],
            "details": "Create the 8x10 hexagonal grid structure (coordinates 0,0 to 7,9). Develop a randomization algorithm to select between 21 and 30 unique coordinates to host star systems. Ensure no duplicate coordinates are selected.\n<info added on 2025-11-23T17:51:50.580Z>\nCompleted implementation of hex grid coordinate system (8x10 grid) and star placement algorithm. The algorithm generates 21-30 unique star system coordinates, handles the hex grid's offset coordinate system regarding even/odd column differences, and ensures no duplicate coordinates. It places the first 20 systems randomly, then fills remaining slots by connecting to existing systems to avoid orphaned clusters. All coordinates are validated to be within grid bounds (0-7 for x, 0-9 for y). Implementation includes helper functions for hex neighbor calculation and distance measurement.\n</info added on 2025-11-23T17:51:50.580Z>",
            "status": "done",
            "testStrategy": "Run the placement function 100 times and verify that the system count is always between 21 and 30, and all coordinates are unique and within bounds."
          },
          {
            "id": 2,
            "title": "Develop World Attribute Generation Logic",
            "description": "Generate specific attributes for each star system using RNG and Faker.js.",
            "dependencies": [
              1
            ],
            "details": "Integrate Faker.js to generate unique system names. Implement RNG logic to assign values for Atmosphere, Temperature, Biosphere, Population, Tech Level, and Government for each system based on the game rules.\n<info added on 2025-11-23T17:52:05.063Z>\nCompleted world attribute generation logic using RNG and Faker.js:\n- Integrated Faker.js for unique system and world name generation\n- Implemented 2d6 roll-based generation for all attributes:\n  - Atmosphere: 7 types (Corrosive, Inert, Airless, Breathable, Thick, Thin, Exotic)\n  - Temperature: 7 types (Frozen, Cold, Variable Cold, Temperate, Variable Warm, Warm, Burning)\n  - Biosphere: 7 types (Remnant, Microbial, None, Human-miscible, Immiscible, Hybrid, Engineered)\n  - Population: 7 levels (Failed Colony through Billions)\n  - Tech Level: 0-5 (TL0 through TL5)\n  - Government: Random selection from 15 government types\n- All values validated to be within correct ranges\n</info added on 2025-11-23T17:52:05.063Z>",
            "status": "done",
            "testStrategy": "Unit test the attribute generator to ensure all values fall within valid ranges (e.g., Tech Level 0-5) and names are strings."
          },
          {
            "id": 3,
            "title": "Implement World Tag Assignment Logic",
            "description": "Assign specific descriptive tags to each generated world to provide gameplay context.",
            "dependencies": [
              2
            ],
            "details": "Define a constant array of available World Tags. Create a function to randomly assign exactly 2 unique tags to each system object generated in the previous step.\n<info added on 2025-11-23T17:52:14.140Z>\nCompleted world tag assignment logic. Defined complete list of 100 world tags from SWN rules. Implemented function to randomly assign exactly 2 unique tags per system. Tags are selected without replacement to ensure uniqueness. Tags array is properly included in each PrimaryWorld object.\n</info added on 2025-11-23T17:52:14.140Z>",
            "status": "done",
            "testStrategy": "Verify that every generated system object contains an array of exactly two distinct strings in its tags property."
          },
          {
            "id": 4,
            "title": "Develop Spike Route Generation Algorithm",
            "description": "Calculate and generate travel routes between systems based on grid distance.",
            "dependencies": [
              1
            ],
            "details": "Implement logic to calculate hex distances between all systems. Generate 'Spike Routes' connecting systems based on Drive ratings (1-6). Ensure the network is fully connected so there are no orphaned systems unreachable from the main cluster.\n<info added on 2025-11-23T17:52:24.576Z>\nCompleted spike route generation algorithm. Implemented hex distance calculation and generated routes based on spike drive ratings, with standard postech drives reaching up to 3 hexes. Ensured network connectivity using BFS traversal to detect orphaned systems, automatically connecting unreachable systems to the nearest connected system. Routes are bidirectional and all systems are guaranteed to be reachable.\n</info added on 2025-11-23T17:52:24.576Z>",
            "status": "done",
            "testStrategy": "Perform a graph traversal (BFS/DFS) on the generated routes to confirm that a path exists from any system to any other system."
          },
          {
            "id": 5,
            "title": "Create Sector Generation Service and Validate Schema",
            "description": "Aggregate all generation logic into a single service and validate output format.",
            "dependencies": [
              2,
              3,
              4
            ],
            "details": "Combine the grid, attribute, tag, and route logic into a main `SectorGenerator` utility service. Ensure the final JSON output strictly adheres to the 'Sector Schema' defined in the PRD, including correct data types for all fields.\n<info added on 2025-11-23T17:52:43.294Z>\nCompleted sector generation service and schema validation. Created main generateSector() function that orchestrates all generation steps, combining grid placement, world attributes, tags, and route generation. Output strictly adheres to Sector Schema from PRD, including Sector UUID, name, timestamp, and systems array. Validated that each system contains id, name, coordinates, primaryWorld, secondaryWorlds, pointsOfInterest, and routes, with PrimaryWorld including all required fields and correct types. Created comprehensive test suite (7 tests) that validates system count (21-30), unique coordinates, valid coordinate bounds, valid world attributes, route generation, network connectivity (no orphans), and schema compliance. All tests passing.\n</info added on 2025-11-23T17:52:43.294Z>",
            "status": "done",
            "testStrategy": "Generate a full sector and validate the output object against a TypeScript interface or JSON schema validator matching the PRD."
          }
        ]
      },
      {
        "id": 3,
        "title": "Interactive Hex Map Visualization",
        "description": "Render the generated sector data onto an interactive SVG/Canvas map using D3.js or Hexagon.js.",
        "details": "Develop the 'SectorMap' component. Use D3.js or Hexagon.js to render the 8x10 grid. Map the system data from the Redux store to specific hex coordinates. Draw lines for Spike Routes. Implement zoom and pan navigation. Create visual markers for systems, colored by primary world attributes. Ensure the map is responsive and fits within the UI layout.",
        "testStrategy": "Visual inspection of the map rendering. Test zoom and pan functionality. Verify that the visual representation matches the underlying Redux state data (e.g., correct number of nodes and connections).",
        "priority": "high",
        "dependencies": [
          2
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Initialize SectorMap Component and Base Grid",
            "description": "Create the React component and render the initial 8x10 hexagonal grid structure using D3.js.",
            "dependencies": [],
            "details": "Scaffold the 'SectorMap' component. Initialize the SVG container. Configure the hex layout generator (using d3-hexbin or manual math) to create an 8x10 grid. Render the base hex polygons with default styling to establish the coordinate system.\n<info added on 2025-11-23T17:55:56.445Z>\nCompleted initialization of SectorMap component with base hex grid rendering. Updated sectorSlice to store sector data with setSector and clearSector actions. Created SectorMap.tsx component that uses D3.js for SVG rendering, implements hexToPixel function for offset coordinate system (odd-r layout), generates and renders an 8x10 hexagonal grid, uses proper hexagon path generation for SVG, and centers the grid in the viewport. Integrated SectorMap into App.tsx with a Generate New Sector button. Created index.ts for clean exports. The base grid is now rendering correctly. Next step is to render system markers from Redux data.\n</info added on 2025-11-23T17:55:56.445Z>",
            "status": "done",
            "testStrategy": "Visual inspection to ensure an 8x10 grid of hexagons is rendered correctly on the screen."
          },
          {
            "id": 2,
            "title": "Render System Markers from Redux Data",
            "description": "Map the generated system data from the Redux store to specific hex coordinates on the grid.",
            "dependencies": [
              1
            ],
            "details": "Connect the component to the Redux 'sector' slice. Iterate through the systems array, calculate the pixel (x, y) center for each system's hex coordinate, and render a visual marker (circle/icon). Apply color coding based on the system's primary world tags.\n<info added on 2025-11-23T17:56:50.540Z>\nCompleted rendering system markers from Redux data:\n- Connected component to Redux sector slice using useSelector\n- Mapped system coordinates to pixel positions using hexToPixel function\n- Rendered colored circles at system locations (color-coded by atmosphere type)\n- Added system name labels below markers\n- Ensured markers render correctly positioned on hex grid\n</info added on 2025-11-23T17:56:50.540Z>",
            "status": "done",
            "testStrategy": "Verify that the number of markers matches the number of generated systems and that they appear in the correct hex slots."
          },
          {
            "id": 3,
            "title": "Visualize Spike Route Connections",
            "description": "Draw lines connecting systems to represent the generated Spike Routes.",
            "dependencies": [
              2
            ],
            "details": "Iterate through the adjacency/route data in the Redux store. For every connection between two systems, draw an SVG line or path connecting their center coordinates. Ensure these lines are rendered on a layer below the system markers for visual clarity.\n<info added on 2025-11-23T17:57:02.517Z>\nImplementation complete: Created a routes group rendered below systems for visual clarity. Built a system ID map for efficient route lookup and collected unique route pairs to avoid duplicate lines. Rendered SVG lines connecting system centers, styled with blue dashed lines for visibility, and ensured routes are properly centered with the grid and systems.\n</info added on 2025-11-23T17:57:02.517Z>",
            "status": "done",
            "testStrategy": "Visual check to confirm lines connect the correct systems without dangling endpoints."
          },
          {
            "id": 4,
            "title": "Implement Zoom and Pan Interaction",
            "description": "Add interactive navigation controls to allow users to explore the map.",
            "dependencies": [
              3
            ],
            "details": "Integrate 'd3-zoom' behavior onto the SVG container. Define scale extents (min/max zoom levels). Implement the event handler to apply translation and scaling transforms to the main grid group `<g>` based on mouse wheel and drag events.\n<info added on 2025-11-23T17:57:10.212Z>\nCompleted zoom and pan interaction. Integrated d3-zoom behavior onto SVG container with scale extents configured from 0.5x to 3x. Created a zoom-container group for all zoomable content and implemented the event handler to apply transforms. Set initial zoom transform to center and fit the grid, supporting mouse wheel zoom and drag panning.\n</info added on 2025-11-23T17:57:10.212Z>",
            "status": "done",
            "testStrategy": "Manually test panning to edges and zooming in/out to ensure smooth transitions and correct boundary limits."
          },
          {
            "id": 5,
            "title": "Responsive Layout and Container Integration",
            "description": "Ensure the map component resizes dynamically to fit the application UI.",
            "dependencies": [
              4
            ],
            "details": "Implement a `ResizeObserver` hook on the parent container. Update the SVG's `width`, `height`, and `viewBox` attributes dynamically when the window resizes to ensure the map remains centered and fully visible within the dashboard layout.\n<info added on 2025-11-23T17:57:22.321Z>\nCompleted responsive layout integration:\n- Added ResizeObserver hook to monitor container size changes\n- Implemented dynamic dimension state management\n- Updated SVG width/height attributes on resize\n- Recalculated grid centering and initial zoom on dimension changes\n- Set minimum dimensions (400x300) to prevent layout issues\n- Ensured map adjusts smoothly to window/sidebar resizing\n</info added on 2025-11-23T17:57:22.321Z>",
            "status": "done",
            "testStrategy": "Resize the browser window and toggle the sidebar (if any) to verify the map adjusts its size without distortion."
          }
        ]
      },
      {
        "id": 4,
        "title": "System Details & Inspection UI",
        "description": "Create the UI overlays and panels to display detailed information about selected star systems.",
        "details": "Implement 'SystemNode' and 'WorldDetails' components. Add hover events to hexes to show summary tooltips. Add click events to open a detailed side panel or overlay showing full world stats (Atmosphere, Tags, Trade Codes, etc.). Implement the 'Secondary Worlds' and 'Points of Interest' display logic within the details panel.",
        "testStrategy": "Click through various systems on the map and verify the details panel populates with the correct data corresponding to the clicked system. Test accessibility (keyboard navigation to systems).",
        "priority": "medium",
        "dependencies": [
          3
        ],
        "status": "in-progress",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement SystemNode Component and Tooltips",
            "description": "Create the visual representation of a star system on the map and implement hover tooltips for quick summary data.",
            "dependencies": [],
            "details": "Develop the 'SystemNode' React component to render the star graphic within the hex grid. Implement `onMouseEnter` and `onMouseLeave` events to trigger a floating tooltip displaying the System Name and Star Class. Ensure the tooltip position calculates correctly relative to the viewport.",
            "status": "done",
            "testStrategy": "Hover over various systems on the map to verify the tooltip appears with the correct name and disappears when the mouse leaves."
          },
          {
            "id": 2,
            "title": "System Selection State Management",
            "description": "Implement the logic to handle system selection via click events and store the active system in the application state.",
            "dependencies": [
              1
            ],
            "details": "Update the Redux store (or local context) to include a `selectedSystemId` field. Add an `onClick` handler to the 'SystemNode' component that dispatches the selection action. Ensure clicking empty space or a close button clears the selection.",
            "status": "done",
            "testStrategy": "Click a system and verify the Redux DevTools show the correct ID in the state. Click away to verify the state clears."
          },
          {
            "id": 3,
            "title": "WorldDetails Panel - Core Layout & Stats",
            "description": "Create the side panel UI to display the primary statistics of the selected world.",
            "dependencies": [
              2
            ],
            "details": "Develop the 'WorldDetails' component that slides in or appears when a system is selected. Bind it to the `selectedSystemId`. Display core attributes: System Name, Atmosphere, Temperature, Biosphere, Population, Tech Level, and Government type.",
            "status": "done",
            "testStrategy": "Select a system and verify the side panel opens. Check that the displayed text matches the data in the source JSON for that system."
          },
          {
            "id": 4,
            "title": "WorldDetails Panel - Extended Data & Lists",
            "description": "Implement the display logic for complex data structures like World Tags, Trade Codes, and Points of Interest.",
            "dependencies": [
              3
            ],
            "details": "Extend the 'WorldDetails' component to render lists for World Tags (with tooltips for tag effects), Trade Codes, 'Secondary Worlds', and 'Points of Interest'. Handle cases where these arrays are empty gracefully.",
            "status": "done",
            "testStrategy": "Select a system with multiple tags and secondary worlds. Verify all items are rendered in the list. Select a system with no POIs to verify the section is hidden or shows 'None'."
          },
          {
            "id": 5,
            "title": "Accessibility & UI Polish",
            "description": "Ensure the system inspection UI is accessible via keyboard and visually polished.",
            "dependencies": [
              3
            ],
            "details": "Add `tabIndex` to 'SystemNode' elements. Implement `onKeyDown` handlers to allow selecting a system via the Enter key. Ensure focus management moves to the 'WorldDetails' panel when opened and returns to the map when closed. Apply final CSS styling for transitions.",
            "status": "done",
            "testStrategy": "Navigate the map using only the Tab key. Select a system with Enter. Verify focus moves to the details panel. Close the panel with Esc and verify focus returns to the map."
          }
        ]
      },
      {
        "id": 5,
        "title": "Faction Data Model & Creation Interface",
        "description": "Implement the faction state slice and the user interface for creating and configuring factions.",
        "details": "Define the 'Faction Schema' in Redux. Create the 'FactionCreation' interface allowing users to select Faction Types, Homeworld (from generated sector), Tags, and Goals. Implement logic to calculate initial attributes (HP, Force, Cunning, Wealth) based on type. Initialize the 'facCreds' and 'assets' array. Ensure unique IDs using UUID generation.",
        "testStrategy": "Create multiple factions via the UI and inspect the Redux store to ensure attributes are calculated correctly and the homeworld is correctly linked to a system ID.",
        "priority": "high",
        "dependencies": [
          2
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Define Faction Redux Slice and Types",
            "description": "Create the initial Redux slice for factions and define the necessary TypeScript interfaces for the data model.",
            "dependencies": [],
            "details": "Define the `Faction` interface including fields for id, name, type, stats (HP, Force, Cunning, Wealth), tags, goals, homeworldId, assets array, and facCreds. Create `factionSlice.ts` with an initial empty state and an `addFaction` reducer to handle state updates.",
            "status": "done",
            "testStrategy": "Verify initial state is empty and the reducer accepts a payload matching the defined TypeScript schema without errors."
          },
          {
            "id": 2,
            "title": "Implement Faction Attribute Calculation Logic",
            "description": "Develop utility functions to calculate initial faction statistics based on the selected Faction Type.",
            "dependencies": [
              1
            ],
            "details": "Create a helper function `calculateFactionStats(type)` that returns base HP, Force, Cunning, and Wealth values defined in the game rules. Implement UUID generation for unique faction IDs. Define constants for Faction Types and Tags.",
            "status": "done",
            "testStrategy": "Unit test the helper function with different faction types (e.g., Hegemony vs. Corporation) to ensure correct stat values are returned."
          },
          {
            "id": 3,
            "title": "Develop Faction Creation Form Component",
            "description": "Build the user interface for inputting basic faction details such as name, type, tags, and goals.",
            "dependencies": [
              1
            ],
            "details": "Create `FactionCreationForm.tsx`. Use local state to manage inputs. Implement dropdowns for Faction Type and Tags based on constants. Ensure validation for required fields (Name length, Type selection).",
            "status": "done",
            "testStrategy": "Render the form and verify that inputs update local state and validation errors appear for empty required fields."
          },
          {
            "id": 4,
            "title": "Implement Homeworld Selection Logic",
            "description": "Add functionality to the creation form to allow selecting a starting homeworld from existing generated systems.",
            "dependencies": [
              3
            ],
            "details": "Connect the form to the `sector` Redux slice to retrieve a list of generated systems. Create a selector input that stores the `systemId` as the `homeworld`. Display system names and coordinates in the selection list.",
            "status": "done",
            "testStrategy": "Mock the sector store with dummy systems and verify they appear correctly in the selection dropdown within the form."
          },
          {
            "id": 5,
            "title": "Integrate Faction Creation with Redux Store",
            "description": "Wire up the form submission to generate the full faction object and dispatch it to the global store.",
            "dependencies": [
              2,
              4
            ],
            "details": "Implement the `onSubmit` handler. Combine form data with `calculateFactionStats` results and a generated UUID. Dispatch the `addFaction` action. Initialize `assets` as an empty array and `facCreds` to the default starting value.",
            "status": "done",
            "testStrategy": "Submit the form and inspect the Redux DevTools to confirm a new Faction object is added to the state with all calculated fields and the correct homeworld link."
          }
        ]
      },
      {
        "id": 6,
        "title": "Asset System & Drag-and-Drop Management",
        "description": "Develop the asset library, purchasing logic, and drag-and-drop placement system.",
        "details": "Create the 'Asset Schema' and a library of static asset definitions (Force, Cunning, Wealth types). Implement 'AssetList' and 'FactionDashboard' components. Use React DnD to allow dragging assets from the dashboard onto the Sector Map systems. Implement validation logic (e.g., can only place if affordable, valid location). Deduct FacCreds upon purchase. Update the Faction slice with new asset instances.",
        "testStrategy": "Test purchasing an asset (verify credits decrease). Test dragging an asset to a valid system (verify asset location updates). Test dragging to an invalid location (verify action is rejected).",
        "priority": "high",
        "dependencies": [
          3,
          5
        ],
        "status": "pending",
        "subtasks": [
          {
            "id": 1,
            "title": "Define Asset Schema and Static Library",
            "description": "Create the TypeScript interfaces and static data definitions for all available faction assets.",
            "dependencies": [],
            "details": "Define the `Asset` interface including properties for id, name, type (Force, Cunning, Wealth), cost, hp, attack, and tags. Create a static library file (e.g., `assetLibrary.ts`) exporting an array of all standard assets defined in the game rules. Ensure strict typing for asset categories.\n<info added on 2025-11-24T00:15:41.479Z>\nCompleted asset schema and static library implementation.\n\n1. Created `src/types/asset.ts` with comprehensive type definitions:\n   - AssetCategory, AssetType, AttackType enums\n   - AttackPattern and CounterattackPattern interfaces\n   - AssetDefinition interface (template/blueprint for assets)\n   - FactionAssetInstance interface (instances owned by factions)\n\n2. Created `src/data/assetLibrary.ts` with complete static asset library:\n   - All Force assets (1-8 rating, 18 assets total)\n   - All Cunning assets (1-8 rating, 25 assets total)\n   - All Wealth assets (1-8 rating, 19 assets total)\n   - Helper functions: getAssetById, getAssetsByCategory, getAssetsByRating, getAllAssetsForFaction\n   - Parsed attack/counterattack patterns from game rules\n   - Included all special flags (A=action, S=special, P=permission)\n   - Set maintenance costs where applicable\n\nTotal: 62 unique asset definitions covering all three categories across all rating levels. All assets properly typed and validated.\n</info added on 2025-11-24T00:15:41.479Z>",
            "status": "done",
            "testStrategy": "Unit test the static library to ensure all defined assets adhere to the schema and contain valid non-negative values for costs and stats."
          },
          {
            "id": 2,
            "title": "Implement Faction Redux Slice Actions for Assets",
            "description": "Update the Redux store to handle asset state, including purchasing and placement logic.",
            "dependencies": [
              1
            ],
            "details": "Extend the `factionSlice` to include an `assets` array within the faction state. Create reducers for `addAsset` (deducts credits, adds asset instance) and `removeAsset`. Implement logic to track asset location (System ID) within the state object.\n<info added on 2025-11-24T00:23:09.110Z>\nCompleted Redux slice actions for asset management:\n\n1. Updated FactionAsset interface in `src/types/faction.ts`:\n   - Changed from storing `type` and `category` directly to using `definitionId` that references AssetDefinition\n   - Added optional `purchasedTurn` field for turn tracking\n   - Maintains backward compatibility with existing structure\n\n2. Extended `factionsSlice.ts` with new reducers:\n   - `addAsset`: Validates credits, required rating, creates asset instance, deducts cost\n   - `removeAsset`: Removes asset, optionally refunds half cost (per SWN rules)\n   - `updateAsset`: Updates asset properties (HP, location, stealth status, etc.)\n   - `moveAsset`: Helper for relocating assets between systems\n\n3. Validation logic in `addAsset`:\n   - Checks faction has sufficient FacCreds\n   - Validates faction has required rating for asset category\n   - Tracks asset count (note: excess assets allowed per rules, but will cost extra maintenance)\n   - Generates unique UUID for asset instance\n\n4. Exported payload types (AddAssetPayload, RemoveAssetPayload) for use in components\n\nAll reducers properly typed and integrated with asset library. Ready for UI integration.\n</info added on 2025-11-24T00:23:09.110Z>",
            "status": "done",
            "testStrategy": "Write unit tests for the reducer: verify that dispatching `addAsset` correctly reduces `facCreds` and increases the asset count in the state."
          },
          {
            "id": 3,
            "title": "Build FactionDashboard and AssetList Components",
            "description": "Develop the UI components to display faction resources and the list of purchasable assets.",
            "dependencies": [
              1,
              2
            ],
            "details": "Create a `FactionDashboard` container that connects to the Redux store to show current FacCreds. Implement an `AssetList` child component that maps through the static asset library and renders individual `AssetCard` components with their stats and costs.\n<info added on 2025-11-24T00:27:15.938Z>\nImplemented AssetCard component displaying name, category, cost, HP, type, tech level, attack patterns, and special flags with visual feedback for affordability. Built AssetList component featuring attribute-based filtering, category filters, search functionality, and sorting. Created FactionDashboard with a sidebar showing FacCreds, attributes, goals, and tags, alongside a responsive main area for the asset list. Updated FactionManager to display the dashboard upon selection and integrated a basic purchase handler pending drag-and-drop implementation.\n</info added on 2025-11-24T00:27:15.938Z>",
            "status": "done",
            "testStrategy": "Render the dashboard with a mock state. Verify that the credit amount matches the store and that the correct number of asset cards are displayed."
          },
          {
            "id": 4,
            "title": "Integrate React DnD for Asset Interaction",
            "description": "Implement the drag-and-drop providers and hooks to enable asset manipulation.",
            "dependencies": [
              3
            ],
            "details": "Wrap the application or dashboard in `DndProvider`. Use `useDrag` on `AssetCard` components to pass asset ID and cost as the drag payload. Update the `SystemNode` component (from the Map module) to use `useDrop`, accepting the 'ASSET' item type.\n<info added on 2025-11-24T00:35:35.732Z>\nCompleted React DnD integration. Installed `react-dnd` and `react-dnd-html5-backend`. Wrapped the application in `DndProvider`. Implemented `useDrag` in `AssetCard` with a payload containing assetDefinitionId, assetName, cost, and factionId, adding visual feedback (opacity/rotation) and conditional drag logic based on funds/selection. Created a `SystemDropZone` component using `useDrop` to accept 'ASSET' types with hover indicators. Integrated these drop zones into `SectorMap` as overlays positioned over system markers, handling SVG-to-container coordinate transformations and zoom/pan updates. Added CSS for drag states and transitions.\n</info added on 2025-11-24T00:35:35.732Z>",
            "status": "done",
            "testStrategy": "Use React Testing Library or Cypress to simulate a drag event. Verify that the `isDragging` state triggers visual changes on the source component."
          },
          {
            "id": 5,
            "title": "Implement Placement Validation and Purchase Logic",
            "description": "Connect the drop event to business logic to validate and finalize asset purchases.",
            "dependencies": [
              2,
              4
            ],
            "details": "In the `onDrop` handler of the System node, implement validation checks: Ensure the faction has enough credits and the system is a valid target. If valid, dispatch the `addAsset` Redux action with the specific System ID. If invalid, trigger a UI notification.\n<info added on 2025-11-24T00:49:30.100Z>\nImplemented a global notification system with success, error, and info types to provide user feedback. Created a validation utility (`src/utils/assetValidation.ts`) that checks for asset existence, sufficient FacCreds, and required Faction Ratings. Enhanced the SectorMap drop handler and FactionManager purchase button to run these validations before dispatching Redux actions. The system now prevents invalid purchases and displays specific error or success notifications for all interaction outcomes.\n</info added on 2025-11-24T00:49:30.100Z>",
            "status": "done",
            "testStrategy": "Integration test: Attempt to drag an asset to a system with insufficient credits (expect no change). Drag to a valid system with sufficient credits (expect credit deduction and asset appearance)."
          }
        ]
      },
      {
        "id": 7,
        "title": "Turn Management & Economic Engine",
        "description": "Implement the core game loop, including income generation, maintenance, and action phases.",
        "details": "Create a 'TurnManager' service/component. Implement the state machine for phases: Income -> Maintenance -> Action -> News. Logic for Income Phase: Calculate Wealth + Asset bonuses. Logic for Maintenance: Deduct upkeep costs. Logic for Action Phase: Lock UI to single action selection. Implement 'Undo/Redo' functionality using Immer patches or Redux history.",
        "testStrategy": "Simulate a full turn. Verify resources increase during Income and decrease during Maintenance. Verify the turn counter increments and state saves correctly.",
        "priority": "high",
        "dependencies": [
          6
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement TurnManager State Machine",
            "description": "Create the Redux slice and state machine to manage turn counters and phase transitions.",
            "dependencies": [],
            "details": "Define the initial state with `turn: 1` and `phase: 'Income'`. Create reducers for `advancePhase` that cycle through Income -> Maintenance -> Action -> News. Ensure the turn counter increments only when transitioning from News back to Income. Expose selectors for the current phase and turn number.\n<info added on 2025-11-24T01:14:04.645Z>\nCompleted implementation of the TurnManager state machine. Created `src/store/slices/turnSlice.ts` which handles turn counting, phase cycling (Income -> Maintenance -> Action -> News -> Income), action staging, commitment tracking, and Undo/Redo history for the Action phase. Integrated the turn slice into the Redux store. Developed `src/hooks/useTurnPhase.ts` to expose state access, action constraints, and history snapshots. Verified that the turn counter increments correctly when transitioning from News back to Income.\n</info added on 2025-11-24T01:14:04.645Z>\n<info added on 2025-11-24T01:18:49.452Z>\nCompleted implementation of the TurnManager state machine:\n\n1. Created `src/store/slices/turnSlice.ts`:\n   - Defined TurnPhase type: 'Income' | 'Maintenance' | 'Action' | 'News'\n   - Initial state: turn: 1, phase: 'Income'\n   - Implemented phase cycling: Income -> Maintenance -> Action -> News -> Income (incrementing turn on News->Income transition)\n   - Added action staging logic: stageAction(), commitAction(), cancelStagedAction()\n   - Implemented Undo/Redo history system with saveHistorySnapshot(), undo(), redo()\n   - History limited to 50 snapshots, only active during Action phase\n   - Added comprehensive selectors for all state and derived flags\n\n2. Created `src/hooks/useTurnPhase.ts`:\n   - Exposes all turn state (turn, phase, actionStaged, etc.)\n   - Provides action constraints (canStageAction, canCommitAction, canUndo, canRedo)\n   - Exposes all action handlers (advancePhase, stageAction, commitAction, etc.)\n   - Provides history snapshot access for state restoration\n\n3. Integrated turn slice into Redux store at `src/store/store.ts`\n\nThe implementation follows SWN rules where:\n- Turn increments only when transitioning from News back to Income\n- Action phase allows only one action per turn (enforced via staging/commitment)\n- History is cleared when leaving Action phase or committing an action\n- History supports undo/redo during Action phase before commit\n</info added on 2025-11-24T01:18:49.452Z>",
            "status": "done",
            "testStrategy": "Unit test the reducer to verify the phase cycle order and ensure the turn counter increments correctly after a full cycle."
          },
          {
            "id": 2,
            "title": "Develop Income Phase Logic",
            "description": "Implement the calculation engine for generating faction credits based on wealth and assets.",
            "dependencies": [
              1
            ],
            "details": "Create a thunk or saga triggered on entering the 'Income' phase. It should query the Asset Registry (from Task 6) for the current faction's assets, sum their income values, add the base Faction Wealth, and dispatch an update to increase the Faction's credit balance.\n<info added on 2025-11-24T01:14:14.622Z>\nCompleted Income Phase Logic. Added calculateTurnIncome() utility function to src/utils/factionCalculations.ts using the formula ceil(Wealth/2) + floor((Force+Cunning)/4) to match SWN rules. Added processIncomePhase reducer to factionsSlice.ts to iterate through factions, calculate income based on attributes, and update FacCreds. Created src/services/turnManager.ts service to coordinate phase transitions, automatically process the Income phase, and provide startNewTurn() and advanceTurnPhase() functions. Income is now automatically calculated and distributed to all factions upon entering the phase.\n</info added on 2025-11-24T01:14:14.622Z>\n<info added on 2025-11-24T01:22:21.793Z>\nCompleted Income Phase Logic implementation:\n1. Added `calculateTurnIncome()` to `src/utils/factionCalculations.ts` implementing the SWN income formula (ceil(Wealth/2) + floor((Force+Cunning)/4)) based on faction attributes; asset bonuses are excluded and will be handled via abilities.\n2. Added `processIncomePhase` reducer to `src/store/slices/factionsSlice.ts` which iterates all factions, calculates income, and updates credit balances automatically.\n3. Created `src/services/turnManager.ts` service with `advanceTurnPhase()`, `startNewTurn()`, and `setPhase()` to manage transitions and trigger income processing when entering the Income phase.\n</info added on 2025-11-24T01:22:21.793Z>",
            "status": "done",
            "testStrategy": "Mock a state with specific assets (e.g., 2 Wealth assets). Trigger the Income phase and assert that the credit balance increases by the expected amount."
          },
          {
            "id": 3,
            "title": "Develop Maintenance Phase Logic",
            "description": "Implement the logic to calculate and deduct upkeep costs for existing assets.",
            "dependencies": [
              1,
              2
            ],
            "details": "Create logic triggered on entering the 'Maintenance' phase. Calculate the total upkeep cost of all deployed assets. Deduct this amount from the Faction's credits. Implement a check for negative balances (bankruptcy) which may trigger a forced asset sale or penalty state (to be defined).\n<info added on 2025-11-24T01:14:27.071Z>\nCompleted Maintenance Phase Logic implementation. Added processMaintenancePhase reducer to factionsSlice.ts to calculate total maintenance costs, handle excess assets with +1 FacCred penalty, and deduct credits allowing for negative balances. Added assetsFailedMaintenance tracking to FactionsState to enforce the two consecutive turns rule for asset removal. Integrated maintenance processing into turnManager.ts to automatically trigger upon entering the Maintenance phase.\n</info added on 2025-11-24T01:14:27.071Z>\n<info added on 2025-11-24T01:24:39.515Z>\nImplemented assetsFailedMaintenance tracking in FactionsState to monitor consecutive failures and enforce the two-turn removal rule. Developed processMaintenancePhase reducer in factionsSlice.ts to calculate base costs and apply the +1 FacCred penalty for assets exceeding category limits. Logic processes payments per asset: successful payments reset failure tracking, while unpaid assets are marked as failed (unusable on the first turn, lost on the second). Allowed for negative balances and debt. Integrated maintenance processing into turnManager.ts to run automatically after the Income phase. Added cleanup logic to clear failure tracking when assets or factions are removed. Ensured adherence to SWN rules: mandatory payment, penalties for excess assets, and strict consequences for non-payment.\n</info added on 2025-11-24T01:24:39.515Z>",
            "status": "done",
            "testStrategy": "Mock a state with high-upkeep assets. Trigger the Maintenance phase and verify credits are deducted. Verify behavior when upkeep exceeds current credits."
          },
          {
            "id": 4,
            "title": "Implement Action Phase Constraints",
            "description": "Create the logic to lock the UI and manage the single-action limitation per turn.",
            "dependencies": [
              1
            ],
            "details": "In the 'Action' phase, track whether an action has been 'staged' or 'committed'. If an action (like moving a unit or buying an asset) is staged, lock other UI elements to prevent concurrent actions. Provide a 'Commit' button to finalize the action and move to the News phase.\n<info added on 2025-11-24T01:14:39.937Z>\nCompleted Action Phase Constraints:\n\n1. Enhanced `turnSlice.ts` with action staging logic:\n   - `actionStaged` flag tracks if an action is currently staged\n   - `actionCommitted` flag tracks if action has been committed\n   - `stageAction()` marks an action as staged (locks other actions)\n   - `commitAction()` commits the action and advances to News phase\n   - `cancelStagedAction()` allows canceling before commit\n\n2. Added selectors:\n   - `selectCanStageAction`: true only if in Action phase and no action staged\n   - `selectCanCommitAction`: true only if action is staged and not yet committed\n\n3. Enhanced `useTurnPhase` hook:\n   - Provides `canStageAction` and `canCommitAction` flags\n   - Provides `stageAction()`, `commitAction()`, `cancelStagedAction()` functions\n   - Components can check these flags before allowing actions\n\nThe UI is now properly constrained to allow only one action per turn during the Action phase. Components should check `useTurnPhase().canStageAction` before dispatching actions.\n</info added on 2025-11-24T01:14:39.937Z>",
            "status": "done",
            "testStrategy": "Simulate the Action phase. Perform one action. Verify that attempting a second distinct action is blocked until the turn is advanced."
          },
          {
            "id": 5,
            "title": "Implement Undo/Redo System",
            "description": "Integrate history management to allow players to revert actions before committing the turn.",
            "dependencies": [
              4
            ],
            "details": "Utilize `immer` patches or a library like `redux-undo` specifically for the Action phase slice. Record the state before an action is applied. Create 'Undo' and 'Redo' UI controls that are enabled only during the Action phase before the 'Commit' event clears the history stack.\n<info added on 2025-11-24T01:14:51.902Z>\nCompleted Undo/Redo System implementation. Added history tracking to turnSlice.ts, utilizing a history array for faction state snapshots, a historyIndex tracker, and a maxHistorySize limit of 50. Implemented saveHistorySnapshot, undo, and redo actions, with logic to clear history upon committing or leaving the Action phase. Enhanced the useTurnPhase hook to expose canUndo and canRedo flags, along with state restoration functions. Configured history management so that future history is discarded if a new action is taken while in an undone state. Note that components must explicitly call saveHistorySnapshot before dispatching actions during the Action phase.\n</info added on 2025-11-24T01:14:51.902Z>",
            "status": "done",
            "testStrategy": "Perform a game action (e.g., move asset). Verify state change. Click Undo. Verify state reverts to original position. Click Redo. Verify state returns to new position."
          },
          {
            "id": 6,
            "title": "Create Turn Management UI Component",
            "description": "Build a user interface component for testing and interacting with the turn management system.",
            "details": "Create a TurnManager component that displays current turn/phase, allows phase advancement, shows action phase controls, displays faction status, and provides visual feedback for the turn cycle. Integrate it into the main layout next to the SectorMap for easy testing.\n<info added on 2025-11-24T01:33:34.668Z>\nCompleted Turn Management UI Component implementation:\n\n1. Created src/components/TurnManager/TurnManager.tsx:\n   - Displays current turn number and phase with color-coded indicators\n   - Shows phase descriptions for each phase\n   - \"Advance to Next Phase\" button that automatically processes Income/Maintenance phases\n   - \"Start New Turn\" button to reset to Income phase\n   - Action Phase controls: staged action display, commit/cancel buttons\n   - Undo/Redo controls with history position indicator\n   - Selected faction status panel showing FacCreds, assets, and next income\n   - All factions summary list\n   - Visual phase cycle indicator showing current and completed phases\n\n2. Created src/components/TurnManager/TurnManager.css:\n   - Styled component with dark theme matching the app\n   - Color-coded phase indicators (Income: blue, Maintenance: orange, Action: red, News: purple)\n   - Responsive layout with proper spacing and borders\n   - Button states and disabled styling\n   - Faction status cards and summary lists\n\n3. Integrated into src/App.tsx:\n   - Added TurnManager component next to SectorMap in sector view\n   - Side-by-side layout with flexbox\n   - TurnManager appears as a sidebar (350-400px width) on the right side\n\nThe component provides a complete testing interface for:\n- Phase transitions and automatic processing\n- Income calculation and distribution\n- Maintenance cost calculation and deduction\n- Action staging and commitment\n- Undo/Redo functionality\n- Real-time faction status updates\n</info added on 2025-11-24T01:33:34.668Z>",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 7
          }
        ]
      },
      {
        "id": 8,
        "title": "Conflict Resolution Engine",
        "description": "Implement the mathematical logic and UI for combat and asset interactions.",
        "details": "Develop the 'CombatResolver' logic. Implement the 1d10 + Attribute vs 1d10 + Attribute formula. Handle damage application to Asset HP and Faction HP. Implement Counterattack logic. Create the 'Combat UI' modal to select Attacker, Target System, and Target Asset. Display odds before confirmation. Use Framer Motion for simple battle animations/feedback.",
        "testStrategy": "Unit test the combat math with fixed seeds to ensure rules compliance (e.g., Force vs Force modifiers). Test the UI flow: Select Attack -> Confirm -> Result -> State Update.",
        "priority": "high",
        "dependencies": [
          7
        ],
        "status": "pending",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement Combat Math Utility",
            "description": "Create the core mathematical functions for combat resolution including dice rolls and modifiers.",
            "dependencies": [],
            "details": "Develop a `CombatResolver` utility module. Implement the formula: `1d10 + Attribute` (Attacker) vs `1d10 + Attribute` (Defender). Include functions to calculate hit margins and determine final damage values based on asset stats.\n<info added on 2025-11-24T01:40:02.306Z>\nCompleted implementation of Combat Math Utility:\n\n1. Created `src/utils/combatResolver.ts` with comprehensive combat resolution functions:\n   - `rollD10()`: Rolls a single d10 (1-10)\n   - `rollDiceExpression()`: Parses and rolls dice expressions like \"1d6\", \"2d4+2\", \"1d8+1\"\n   - `calculateDiceAverage()`: Calculates expected values for odds calculations\n   - `performCombatRoll()`: Implements 1d10 + Attribute vs 1d10 + Attribute comparison\n   - `resolveCombat()`: Complete combat resolution including damage and counterattack logic\n   - `calculateAttackOdds()`: Probability calculation for attack success\n   - `calculateExpectedDamage()`: Expected damage calculation\n   - `calculateExpectedCounterattackDamage()`: Expected counterattack damage\n\n2. Implemented all combat mechanics from SWN rules:\n   - Attack success when attacker roll > defender roll\n   - Attack failure triggers counterattack (if available)\n   - Ties result in both attack and counterattack succeeding\n   - Supports all damage expression formats from asset library\n\n3. Created comprehensive unit tests in `src/utils/combatResolver.test.ts`:\n   - Tests for dice rolling and expression parsing\n   - Tests for combat roll comparisons with fixed seeds\n   - Tests for complete combat resolution (success, failure, ties)\n   - Tests for odds calculations\n   - Tests for edge cases (None damage, special cases, etc.)\n\nAll functions are fully typed with TypeScript interfaces. The implementation follows SWN faction combat rules exactly as specified in the reference materials.\n</info added on 2025-11-24T01:40:02.306Z>",
            "status": "done",
            "testStrategy": "Write unit tests with mocked random number generators (fixed seeds) to verify that the math correctly handles edge cases like ties or critical failures."
          },
          {
            "id": 2,
            "title": "Combat State Management (Redux)",
            "description": "Implement Redux slices and reducers to handle damage application and asset destruction.",
            "dependencies": [
              1
            ],
            "details": "Create Redux actions for `inflictDamage`. Implement logic to reduce Asset HP in the store. If Asset HP drops to 0 or below, trigger asset removal logic and apply overflow damage to the owning Faction's HP.\n<info added on 2025-11-24T01:52:11.122Z>\nCompleted implementation of Combat State Management. Created InflictDamagePayload interface and inflictDamage reducer action. Logic includes reducing asset HP, handling destruction when HP is 0 or less, and applying overflow damage to Faction HP for regular assets. Added special handling for Bases of Influence where damage affects Faction HP up to the Base's HP limit, but destruction overflow is ignored. Included cleanup for failed maintenance tracking and asset removal. Implemented inflictFactionDamage for direct faction HP reduction with a floor of 0. Added comprehensive unit tests in src/store/slices/factionsSlice.test.ts covering damage application, asset destruction, overflow rules, and edge cases.\n</info added on 2025-11-24T01:52:11.122Z>",
            "status": "done",
            "testStrategy": "Dispatch damage actions to the Redux store and assert that the specific Asset's HP decreases and is removed from the state when destroyed."
          },
          {
            "id": 3,
            "title": "Combat Setup Modal & Targeting UI",
            "description": "Build the user interface for selecting combat participants and previewing the engagement.",
            "dependencies": [
              1
            ],
            "details": "Create a `CombatModal` component. Implement form controls to select the Attacking Asset, Target System, and Target Asset. Integrate the math utility to display 'Win Chance' or 'Odds' dynamically as selections change.\n<info added on 2025-11-24T01:55:59.468Z>\nCompleted implementation of Combat Setup Modal & Targeting UI. Created CombatModal component (src/components/Combat/CombatModal.tsx) featuring accessible modal overlay, form controls for participant selection, and automatic target system determination. Implemented validation to filter assets based on attack capability and stealth status. Integrated dynamic odds calculation using calculateAttackOdds to display win chance, expected damage, and roll formulas in real-time. Integrated modal into FactionDashboard with trigger button and state management. Applied responsive styling (src/components/Combat/CombatModal.css) matching app theme. The modal is fully functional and ready for combat resolution integration.\n</info added on 2025-11-24T01:55:59.468Z>",
            "status": "done",
            "testStrategy": "Mount the modal and verify that valid targets are populated in the dropdowns and that the odds calculation updates when the target changes."
          },
          {
            "id": 4,
            "title": "Combat Animation & Result Feedback",
            "description": "Implement visual feedback for the combat action using Framer Motion to show rolls and results.",
            "dependencies": [
              3
            ],
            "details": "Use Framer Motion to create a sequence: 1. Dice roll animation, 2. Display of raw numbers + modifiers, 3. 'Hit' or 'Miss' visual cue, 4. Health bar depletion animation. Ensure the UI blocks interaction during animation.\n<info added on 2025-11-24T02:02:52.449Z>\nCompleted implementation of Combat Animation & Result Feedback. Created `CombatAnimation` component (`src/components/Combat/CombatAnimation.tsx`) featuring a four-phase Framer Motion sequence: Rolling, Showing Rolls, Showing Result, and Showing Damage. Integrated animation with `CombatModal` to handle combat resolution, pre-combat HP tracking, and post-animation Redux state updates for damage and asset destruction. Added `src/components/Combat/CombatAnimation.css` for styling, including a full-screen interaction-blocking overlay with backdrop blur, color-coded result badges, and responsive layout.\n</info added on 2025-11-24T02:02:52.449Z>",
            "status": "done",
            "testStrategy": "Visual inspection of the animation sequence. Verify that the displayed dice results match the internal logic calculations."
          },
          {
            "id": 5,
            "title": "Counterattack Logic & Turn Integration",
            "description": "Implement the automatic counterattack mechanic and finalize the combat action loop.",
            "dependencies": [
              2,
              4
            ],
            "details": "Implement logic to check if the defender survives the initial hit. If eligible, trigger a simplified reverse combat resolution (Counterattack). Deduct the Action Point cost from the active player and close the modal.\n<info added on 2025-11-24T02:05:01.608Z>\nCompleted Implementation:\n1. Verified counterattack logic in `resolveCombat` (triggers on attack failure or tie).\n2. Integrated with turn system using `stageAction('Attack')` and `commitAction()` to auto-advance to News phase.\n3. Added phase validation to restrict combat to the Action phase with visual warnings.\n4. Finalized modal closure and state reset upon animation completion.\n</info added on 2025-11-24T02:05:01.608Z>",
            "status": "done",
            "testStrategy": "Simulate a combat scenario where the defender survives. Verify that the attacker takes damage in return and that the turn state is updated correctly."
          }
        ]
      },
      {
        "id": 9,
        "title": "Narrative Generation & News Feed",
        "description": "Create the system that generates narrative text based on faction actions and game events.",
        "details": "Implement the 'NewsFeed' component. Create a 'NarrativeGenerator' service that takes an action result (e.g., 'Attack Successful') and context (Faction Tags, World Tags) to generate flavor text. Store history of events in the Redux state. Display these events in a scrollable feed in the UI.",
        "testStrategy": "Perform various game actions (Move, Attack, Buy) and verify that a corresponding, coherent news item appears in the feed.",
        "priority": "medium",
        "dependencies": [
          7,
          8
        ],
        "status": "pending",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement Narrative Redux Slice",
            "description": "Create the Redux slice to store the history of game events and narrative logs.",
            "dependencies": [],
            "details": "Define `narrativeSlice` with an initial state containing an empty `logs` array. Create actions like `addLogEntry` which accepts a payload structure `{ id, timestamp, text, type, relatedEntityIds }`. Configure the reducer to append new logs to the start or end of the array based on UI requirements. Export selectors for retrieving the log history.\n<info added on 2025-11-24T02:25:47.649Z>\nImplementation completed successfully. Created `src/store/slices/narrativeSlice.ts` and corresponding tests. The slice initializes with an empty `logs` array and uses `addLogEntry` to prepend new entries (newest-first), auto-generating IDs and timestamps if omitted. Additional actions `clearLogs` and `removeLogEntry` were added. Selectors `selectAllLogs`, `selectLogsByType`, `selectLogsByEntity`, and `selectRecentLogs` are exported. Log types include combat, trade, movement, economic, political, espionage, general, and system. The reducer is integrated into the Redux store configuration, verified by 15 passing unit tests.\n</info added on 2025-11-24T02:25:47.649Z>",
            "status": "done",
            "testStrategy": "Unit test the reducer to ensure `addLogEntry` correctly updates the state and maintains immutability."
          },
          {
            "id": 2,
            "title": "Create Narrative Generator Service",
            "description": "Develop the core utility service that constructs sentences based on action results.",
            "dependencies": [],
            "details": "Create `NarrativeGenerator.js`. Implement a function `generateLog(actionType, actor, target, result)` that selects from a library of string templates. For example, if action is 'Attack' and result is 'Success', return '{ActorName} successfully assaulted {TargetName}'. Include fallback templates for undefined actions.\n<info added on 2025-11-24T02:32:50.317Z>\nImplementation completed successfully.\n\nCreated Files:\nsrc/services/narrativeGenerator.ts\nsrc/services/narrativeGenerator.test.ts\n\nKey Features Implemented:\n1. Template Library: Comprehensive templates for all action types (Attack, Move, Buy, Repair, UseAbility, ExpandInfluence, Income, Maintenance, AssetDestroyed, FactionDamaged) including result variations and fallbacks.\n2. generateLog Function: Accepts actionType and NarrativeContext, selects random templates for variety, and handles placeholder replacement (ActorName, TargetName, AssetName, SystemName, Damage, Credits).\n3. Placeholder Replacement: Robust system handling standard placeholders and edge cases.\n4. getNarrativeLogType Function: Maps actions to log types (combat, economic, movement, system, general).\n5. Fallback Templates: Safe defaults for unknown actions.\n\nTesting:\n34 passing unit tests covering all action types, edge cases, and error handling.\n\nReady for integration with narrative slice and action thunks.\n</info added on 2025-11-24T02:32:50.317Z>",
            "status": "done",
            "testStrategy": "Unit test the service with mock inputs to verify that valid strings are returned for all supported action types."
          },
          {
            "id": 3,
            "title": "Implement Context-Aware Flavor Text",
            "description": "Enhance the generator to incorporate Faction and World tags into the narrative.",
            "dependencies": [
              2
            ],
            "details": "Expand `NarrativeGenerator` to accept context objects (Faction Tags, World Tags). Implement logic to check for specific tags (e.g., 'Fanatical', 'Warlike', 'Radioactive') and prioritize tag-specific templates over generic ones. For instance, a 'Savage' faction attacking might trigger a more violent description.\n<info added on 2025-11-24T02:36:50.725Z>\nImplementation completed successfully. Enhanced `src/services/narrativeGenerator.ts` with a tag-aware template system and added comprehensive tests in `src/services/narrativeGenerator.test.ts`. Key features implemented include:\n\n1.  **Expanded NarrativeContext**: Interface now supports `actorTags`, `targetTags`, and `worldTags`.\n2.  **Tag-Specific Template Library**: Created templates for Faction tags (Savage, Warlike, Fanatical, Secretive, Pirates, Imperialists, Technical Expertise, Plutocratic) and World tags (Radioactive World, Police State, Civil War, Trade Hub, Battleground, Prison Planet, Holy War).\n3.  **Priority Logic**: Implemented selection hierarchy: Actor tags > Target tags > World tags > Generic fallback.\n4.  **Testing**: Verified with 51 passing unit tests, including 17 new tests specifically for tag priority, fallback behavior, and template selection.\n</info added on 2025-11-24T02:36:50.725Z>",
            "status": "done",
            "testStrategy": "Pass specific tags into the generator and assert that the output string matches the expected flavor text associated with those tags."
          },
          {
            "id": 4,
            "title": "Develop NewsFeed UI Component",
            "description": "Create the visual component to display the scrollable list of narrative events.",
            "dependencies": [
              1
            ],
            "details": "Build `NewsFeed.tsx`. Use `useSelector` to fetch logs from the narrative slice. Map logs to list items. Implement a scrollable container with a fixed height. Apply conditional styling based on event type (e.g., red text for combat, green for trade). Ensure the feed handles empty states gracefully.\n<info added on 2025-11-24T02:39:52.271Z>\nImplementation completed successfully. Created src/components/NewsFeed/NewsFeed.tsx and src/components/NewsFeed/NewsFeed.css. Key features include Redux integration fetching logs via selectAllLogs, a configurable scrollable container with dark theme styling, and conditional formatting for specific log types (Combat, Economic, Movement, Political, Espionage, System). The component handles empty states gracefully and includes timestamps, event counts, fade-in animations, and hover effects. Props available: maxHeight and showTimestamp.\n</info added on 2025-11-24T02:39:52.271Z>",
            "status": "done",
            "testStrategy": "Mount the component with a pre-populated Redux state and verify that all log entries are rendered with the correct styles."
          },
          {
            "id": 5,
            "title": "Integrate Narrative Generation with Actions",
            "description": "Hook the narrative generation logic into the main game action thunks.",
            "dependencies": [
              1,
              3
            ],
            "details": "Update existing game action thunks (Move, Attack, Buy) to call `NarrativeGenerator` upon completion. Pass the relevant actor, target, and context data to the generator. Dispatch the resulting text string to the `narrativeSlice` via `addLogEntry`. Ensure system errors are also logged as narrative events where appropriate.\n<info added on 2025-11-24T03:04:21.671Z>\nIntegration completed successfully.\n\n1. Created Narrative Helper Utilities (src/utils/narrativeHelpers.ts) for dispatching entries and extracting context from factions, targets, and systems.\n2. Integrated Attack Action (src/components/Combat/CombatModal.tsx) covering combat resolution, asset destruction, and overflow damage.\n3. Integrated Buy Asset Action in SectorMap.tsx and FactionManager.tsx.\n4. Integrated Income Phase (src/services/turnManager.ts) for income generation logs.\n5. Integrated Maintenance Phase (src/services/turnManager.ts) for maintenance results and asset destruction.\n\nNote: Move Asset action integration is deferred until Task 11.\n</info added on 2025-11-24T03:04:21.671Z>",
            "status": "done",
            "testStrategy": "Perform a game action (e.g., move a unit) and verify that the `narrativeSlice` state increases by one and contains the expected text."
          }
        ]
      },
      {
        "id": 10,
        "title": "Persistence & Save System",
        "description": "Implement local storage saving, auto-save triggers, and JSON import/export functionality.",
        "details": "Create a 'SaveManager' service. Subscribe to Redux store changes to trigger auto-saves to LocalStorage on turn completion. Implement 'Export to JSON' to download the full state (Sector + Factions). Implement 'Import from JSON' to hydrate the Redux store. Ensure versioning is included in the metadata to handle future schema changes.",
        "testStrategy": "Play a session, close the browser, and reopen to verify state is restored. Export a save file, clear local storage, and import the file to verify full state recovery.",
        "priority": "medium",
        "dependencies": [
          5,
          7
        ],
        "status": "pending",
        "subtasks": [
          {
            "id": 1,
            "title": "Define Save Schema and SaveManager Service",
            "description": "Define the data structure for save files including versioning metadata and implement the core SaveManager service.",
            "dependencies": [],
            "details": "Create a `SaveManager` class or module. Define a TypeScript interface for the save payload including `version`, `timestamp`, `sector`, and `factions`. Implement `serialize(state)` and `deserialize(jsonString)` methods. Ensure the version number is configurable to handle future migrations.\n<info added on 2025-11-24T05:18:01.319Z>\nImplementation completed successfully!\n\n**What was implemented:**\n- Created `SaveManager` class in `src/services/saveManager.ts` with:\n  - Configurable version constant (SAVE_VERSION = '1.0.0') for future migrations\n  - SavePayload interface defining save schema with version, timestamp, sector, factions, turn, and phase\n  - `serialize(state)` method that converts RootState to JSON string\n  - `deserialize(jsonString)` method that parses JSON and validates structure\n  - Error handling for invalid JSON and missing required fields\n  - Exported singleton instance for convenience\n\n**Key design decisions:**\n- Included turn and phase in save payload (beyond requirements) for complete game state restoration\n- Used JSON.stringify with 2-space indentation for readable save files\n- Comprehensive validation in deserialize() to catch corrupt or malformed saves early\n- Type-safe implementation with TypeScript interfaces\n\n**Testing:**\n- Created comprehensive test suite with 32 tests covering:\n  - Serialization of all state components (sector, factions, turn, phase)\n  - Deserialization validation and error handling\n  - Round-trip integrity\n  - Edge cases (null sector, empty arrays, complex faction data)\n- All tests passing \n\n**Files created:**\n- `src/services/saveManager.ts` - Main service implementation\n- `src/services/saveManager.test.ts` - Comprehensive unit tests\n\nThe SaveManager is ready for use by the LocalStorage middleware and import/export functionality in subsequent subtasks.\n</info added on 2025-11-24T05:18:01.319Z>",
            "status": "done",
            "testStrategy": "Unit test the serialize and deserialize methods with mock state data to ensure data integrity and correct schema structure."
          },
          {
            "id": 2,
            "title": "Implement LocalStorage Auto-Save Middleware",
            "description": "Develop specific logic to automatically save the application state to the browser's LocalStorage upon specific game events.",
            "dependencies": [
              1
            ],
            "details": "Develop a Redux middleware or use `store.subscribe` to listen for critical actions such as `TURN_COMPLETED` or `ASSET_PURCHASED`. When triggered, invoke `SaveManager.serialize` and write the result to `localStorage.setItem('gameState')`. Implement a debounce mechanism to prevent performance issues.\n<info added on 2025-11-24T05:21:03.833Z>\nImplementation completed successfully. Created Redux middleware localStorageAutoSave in src/store/middleware/localStorageAutoSave.ts that listens for critical game actions including turn management, faction changes, asset management, and combat events. The middleware automatically saves the game state to localStorage with the key gameState, utilizing a 500ms debounce to prevent excessive writes and handling errors such as quota limits. Utility functions saveStateImmediately, clearSavedState, and hasSavedState were implemented. The middleware was integrated into the Redux store configuration in src/store/store.ts. A comprehensive test suite with 16 tests was added in src/store/middleware/localStorageAutoSave.test.ts, verifying auto-save triggers, debouncing, immediate save functionality, and data integrity.\n</info added on 2025-11-24T05:21:03.833Z>",
            "status": "done",
            "testStrategy": "Trigger a state change in the application and verify via DevTools that the `gameState` key in LocalStorage is updated with the correct JSON string."
          },
          {
            "id": 3,
            "title": "Develop JSON Export Functionality",
            "description": "Implement the logic to generate a downloadable JSON file representing the current game state for user backup.",
            "dependencies": [
              1
            ],
            "details": "Create an `exportSave` function within the SaveManager. This function should retrieve the current state, serialize it, create a `Blob` with type `application/json`, and programmatically trigger an anchor tag click to download the file. The filename should include the current date and time.\n<info added on 2025-11-24T05:28:37.050Z>\nImplementation completed successfully.\n\n**Implementation Details:**\n- Created `exportSave` function in `SaveManager` class (`src/services/saveManager.ts`).\n- Serializes current game state to JSON using existing `serialize()` method.\n- Creates a Blob with `application/json` MIME type.\n- Generates filenames with zero-padded date/time (format: `swn-save-YYYY-MM-DD-HH-MM-SS.json`) to ensure uniqueness and proper sorting.\n- Programmatically triggers download via a temporary anchor element.\n- Includes resource cleanup (anchor removal, URL revocation) and error handling.\n\n**Testing Results:**\n- Added 17 specific tests covering Blob creation, serialization, anchor manipulation, filename formatting, download triggering, and cleanup.\n- Verified data integrity and error handling.\n- All 49 tests are passing.\n\n**Note:** The UI component to call this function will be created in subtask 10.5 (SaveMenu component).\n</info added on 2025-11-24T05:28:37.050Z>",
            "status": "done",
            "testStrategy": "Invoke the export function and verify that a file named with the correct pattern is downloaded and contains valid JSON data."
          },
          {
            "id": 4,
            "title": "Develop JSON Import and State Hydration",
            "description": "Implement the logic to read a user-uploaded JSON file, validate its contents, and replace the current application state.",
            "dependencies": [
              1
            ],
            "details": "Create an `importSave` function that accepts a File object. Use `FileReader` to read the text. Parse the JSON and validate the `version` metadata. Create a Redux action `HYDRATE_STATE` and a corresponding reducer case to replace the `sector` and `factions` slices with the loaded data.\n<info added on 2025-11-24T05:49:52.693Z>\nImplementation completed successfully.\n\n1. **SaveManager**: Created `importSave` function in `src/services/saveManager.ts` which accepts a File object, uses FileReader to parse JSON, validates structure and version, and returns a Promise<SavePayload>.\n2. **Redux Actions**: Created hydration actions in `sectorSlice` (`hydrateSector`), `factionsSlice` (`hydrateFactions`), and `turnSlice` (`hydrateTurn`) to replace state and reset UI selections.\n3. **Helper Utility**: Created `hydrateStateFromSave` in `src/utils/hydrateState.ts` to dispatch all hydration actions for full state restoration.\n4. **Testing**: Added 11 comprehensive tests in `src/services/saveManager.test.ts` covering valid parsing, file type validation, version incompatibility, and error handling. All 60 tests passing.\n\nFiles created/modified: `src/services/saveManager.ts`, `src/store/slices/sectorSlice.ts`, `src/store/slices/factionsSlice.ts`, `src/store/slices/turnSlice.ts`, `src/utils/hydrateState.ts`, `src/services/saveManager.test.ts`.\n</info added on 2025-11-24T05:49:52.693Z>",
            "status": "done",
            "testStrategy": "Upload a valid JSON save file and verify the Redux store updates to match the file content. Upload an invalid file to test error handling."
          },
          {
            "id": 5,
            "title": "Create Persistence UI and Error Handling",
            "description": "Build the user interface components for importing and exporting saves and handle potential errors during the process.",
            "dependencies": [
              3,
              4
            ],
            "details": "Develop a `SaveMenu` component containing 'Export Data' and 'Import Data' buttons. Connect the Import button to a hidden file input. Implement error handling to display toast notifications if the imported file is corrupt, has an invalid version, or if LocalStorage quota is exceeded.\n<info added on 2025-11-24T05:56:36.628Z>\nCompleted implementation of SaveMenu component and error handling:\n- Created `src/components/SaveMenu/SaveMenu.tsx` featuring Export/Import buttons and a hidden file input with JSON validation.\n- Implemented error handling logic to catch corrupt files, invalid versions, file read errors, and export failures.\n- Enhanced `src/store/middleware/localStorageAutoSave.ts` to trigger toast notifications for LocalStorage quota exceeded (8s duration) and generic save errors.\n- Applied styling via `src/components/SaveMenu/SaveMenu.css` to match existing UI patterns with responsive layout and hover states.\n- Verified all error scenarios trigger appropriate user-facing toast notifications.\n</info added on 2025-11-24T05:56:36.628Z>",
            "status": "done",
            "testStrategy": "Manually test the UI buttons. Verify that clicking Export downloads a file and clicking Import opens the file picker and successfully loads a save."
          }
        ]
      },
      {
        "id": 11,
        "title": "Implement Faction Actions: Move, Repair, Expand, and Abilities",
        "description": "Develop the logic and user interfaces for non-combat faction actions including Asset Movement, Repairs, Influence Expansion, and Special Abilities, integrating them into the Turn Manager state machine using the stage/commit pattern established in the Conflict Resolution Engine.",
        "status": "pending",
        "dependencies": [
          3,
          6,
          7,
          8
        ],
        "priority": "high",
        "details": "This task focuses on the 'Action Phase' mechanics defined in the TurnManager, adopting the `stageAction` and `commitAction` pattern from Task 8.\n\n1. **Move Asset**: Create a 'MovementMode' state in the UI. When an asset is selected for movement, highlight valid destination hexes on the SectorMap (Task 3). Utilize the existing `moveAsset` reducer in `factionsSlice` by staging the action first.\n\n2. **Repair**: Implement logic for repairing Assets and Faction HP. Add UI controls to the Faction Dashboard. Logic: Calculate cost based on SWN rules. Dispatch `STAGE_ACTION` with repair details.\n\n3. **Expand Influence**: Create a modal interface to select a target world. Implement resolution logic: `1d10 + Attribute vs Difficulty`. On success, update Faction state to include a new 'Base of Influence'.\n\n4. **Use Asset Ability**: Implement a Strategy Pattern mapping Asset IDs to executable functions. Ensure these actions consume the turn's action slot.\n\n5. **Integration**: All actions must check `TurnManager.canAct`, deduct costs, and trigger the `ActionCompleted` state transition via the commit phase.",
        "testStrategy": "1. **Move Test**: Initialize an asset at [0,0]. Attempt to move to a non-adjacent hex (fail). Move to an adjacent hex (pass); verify action is staged, then committed, and FacCreds decrease while coordinates update.\n2. **Repair Test**: Set an asset to 1 HP. Trigger repair action. Verify HP restores to max and correct FacCreds are deducted.\n3. **Expand Test**: Mock the RNG to force a success. Trigger 'Expand Influence' on a target world. Verify the Faction's state now includes a Base of Influence on that world.\n4. **Turn Loop**: Verify that performing any of these actions locks the UI for further actions in the current turn.",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement Asset Movement UI and Logic",
            "description": "Develop the interactive UI for moving assets on the sector map, utilizing the existing Redux logic.",
            "dependencies": [],
            "details": "Create a 'MovementMode' state in the Faction Dashboard. When an asset is selected for movement, calculate and highlight valid adjacent hexes or transit routes on the SectorMap component. Implement validation logic ensuring the faction has 1 FacCred. Dispatch a `STAGE_ACTION` Redux action with payload `{ type: 'MOVE_ASSET', assetId, destination }` to the TurnManager slice, which will trigger the existing `moveAsset` reducer in `factionsSlice` upon commit.\n<info added on 2025-11-24T03:22:24.249Z>\nCompleted implementation of Asset Movement UI and Logic. Created movementUtils.ts for calculating valid destinations including adjacent hexes and route-connected systems. Added movement mode state to Redux turnSlice with start and cancel actions. Updated FactionDashboard to display owned assets with Move buttons, activate movement mode, show indicators, and validate FacCred availability. Updated SectorMap to highlight valid destination hexes with cyan borders and dashed overlays, handle system clicks during movement mode, and stage the MOVE_ASSET action. Updated useTurnPhase hook to execute movement on commit by deducting 1 FacCred and calling the moveAsset reducer. Created OwnedAssetItem component for asset display and control. Confirmed validation logic ensures sufficient FacCreds, valid destinations, and restriction to the Action phase.\n</info added on 2025-11-24T03:22:24.249Z>",
            "status": "pending",
            "testStrategy": "Select an asset at [0,0]. Activate move mode. Verify adjacent hexes are highlighted. Click a valid hex and confirm the action is staged in the state with correct cost. Commit the action and verify the asset moves."
          },
          {
            "id": 2,
            "title": "Implement Repair Action Logic and UI",
            "description": "Create the mechanism for repairing damaged assets and restoring Faction HP, including cost calculation.",
            "dependencies": [],
            "details": "Add 'Repair' controls to Asset Cards and the Faction Header. Implement logic to calculate cost: `(MaxHP - CurrentHP) * CostPerHP`. Create a confirmation interaction that validates affordability. Dispatch `STAGE_ACTION` with `{ type: 'REPAIR', targetId, cost }`. Ensure the UI updates to show the projected post-repair state and remaining credits.\n<info added on 2025-11-24T02:23:24.344Z>\nUpdate repair logic to match SWN rules. For assets, set base healing equal to the faction's ruling attribute score for 1 FacCred. Implement incremental cost scaling where additional healing amounts cost increasing FacCreds (2 for the second amount, 3 for the third, etc.). For Faction HP, calculate healing as the rounded average of the faction's highest and lowest attribute ratings, with no option to hurry the process via extra spending. Allow the repair action to target multiple assets simultaneously.\n</info added on 2025-11-24T02:23:24.344Z>\n<info added on 2025-11-24T04:46:22.574Z>\nCompleted implementation of Repair Action Logic and UI. Created repairCalculations.ts utility with functions for asset and faction repair costs following SWN rules, including incremental scaling for assets and average attribute calculations for faction HP. Added repairAsset, repairMultipleAssets, and repairFactionHp reducers to factionsSlice. Developed RepairModal component for selecting assets, viewing costs, and validating affordability. Updated FactionDashboard with a conditional repair button and modal integration. Modified useTurnPhase hook to handle repair execution and validation within commitAction. Confirmed logic supports simultaneous repairs and proper stage/commit workflow.\n</info added on 2025-11-24T04:46:22.574Z>",
            "status": "pending",
            "testStrategy": "Manually set an asset to 1/4 HP. Open the repair UI. Verify the calculated cost matches the formula. Confirm the action and check that the repair is staged in the turn manager."
          },
          {
            "id": 3,
            "title": "Implement Asset Special Ability System",
            "description": "Develop a registry of asset abilities and the UI triggers to execute them during a turn.",
            "dependencies": [],
            "details": "Create a `AbilityStrategy` pattern or lookup table mapping AssetTypeIDs to specific functions (e.g., 'Scavenge Fleet', 'Propaganda'). Add 'Use Ability' buttons to Asset Cards. Validate `TurnManager.canAct` (action slot availability). Dispatch `STAGE_ACTION` with `{ type: 'USE_ABILITY', assetId, abilityId }`. Ensure 'Free' actions do not consume the main action slot.\n<info added on 2025-11-24T04:52:15.771Z>\nCompleted implementation of Asset Special Ability System. Created assetAbilities.ts utility module with ability registry, specific implementations (Harvesters, Postech Industry, Venture Capital, Pretech Manufactory, Commodities Broker), and helper functions including support for free actions. Added executeAssetAbility reducer to factionsSlice to handle FacCred gains/losses, asset destruction, and cost validation. Updated useTurnPhase hook to handle USE_ABILITY action type in commitAction. Updated UI components (OwnedAssetItem, FactionDashboard, WorldDetails) with ability buttons, visual distinction for free actions, and CSS styling. Established execution flow to validate actions, execute ability logic, stage actions, and show notifications. System supports dice-based abilities, free actions, and integration with turn manager stage/commit pattern.\n</info added on 2025-11-24T04:52:15.771Z>",
            "status": "pending",
            "testStrategy": "Mock an asset with a 'Generate Wealth' ability. Click the ability button. Verify the action is staged. Verify that using a non-free ability marks the turn action slot as pending usage."
          },
          {
            "id": 4,
            "title": "Implement Expand Influence Action",
            "description": "Build the interface and resolution logic for factions to establish new Bases of Influence on worlds.",
            "dependencies": [],
            "details": "Create a modal triggered by an 'Expand Influence' button. List valid target worlds in the current system (those without existing influence). Implement the resolution logic: `1d10 + Attribute vs Difficulty`. Dispatch `STAGE_ACTION` with `{ type: 'EXPAND_INFLUENCE', targetWorldId }`. Update the reducer to handle success (adding base) or failure.\n<info added on 2025-11-24T05:10:02.080Z>\nCompleted implementation of Expand Influence Action:\n\n1. Created `expandInfluence.ts` utility module:\n   - Defined `BASE_OF_INFLUENCE_ID` constant.\n   - Implemented helpers: `hasBaseOfInfluence`, `getBaseOfInfluence`, `hasAssetsOnWorld`, and `getValidExpandTargets`.\n   - Implemented logic: `resolveExpandInfluenceRoll` (1d10 + Cunning) and `calculateBaseOfInfluenceCost` (1 FacCred per HP).\n\n2. Updated `assetLibrary.ts`:\n   - Modified `getAssetById` to return a Base of Influence definition for the special ID.\n\n3. Updated `factionsSlice`:\n   - Added `addBaseOfInfluence` reducer to handle creation/upgrades, validate FacCreds, and set HP/maxHP.\n\n4. Created UI Components:\n   - `ExpandInfluenceModal`: Lists valid targets, allows HP configuration, displays costs/rules, and handles roll resolution.\n   - `ExpandInfluenceButton`: Reusable trigger with validation, tooltips, and modal integration.\n\n5. Updated `useTurnPhase` hook:\n   - Added `EXPAND_INFLUENCE` handling in `commitAction` to execute Base creation.\n\n6. Integrated into UI:\n   - Added controls to `WorldDetails` and `FactionDashboard`.\n\n7. Rules Implementation:\n   - Enforced requirements (must have other assets on target).\n   - Implemented cost scaling and roll mechanics.\n   - Note: Opposing faction free attacks are pending implementation.\n</info added on 2025-11-24T05:10:02.080Z>",
            "status": "pending",
            "testStrategy": "Trigger expansion on a target world. Mock the RNG to force a success. Verify the faction is added to the world's influence list. Mock a failure and verify resources are consumed without influence gain."
          }
        ]
      },
      {
        "id": 12,
        "title": "UI Layout Reorganization & Design Improvements",
        "description": "Reorganize and improve the user interface layout for better usability, logical component placement, and visual hierarchy.",
        "details": "The current UI has some organizational issues including duplicate headers, cramped sidebars, and unclear separation between functional areas. This task will reorganize the layout to create a more intuitive, spacious, and well-organized interface that follows UX best practices and provides clear visual hierarchy.\n\nKey improvements:\n- Consolidate duplicate header elements\n- Optimize sidebar panel layout and spacing\n- Improve component organization and separation\n- Enhance navigation structure\n- Better responsive design\n- Consistent spacing and visual hierarchy\n- Improved component grouping by functionality",
        "testStrategy": "Visual inspection of the reorganized layout. Verify all components are accessible and properly positioned. Test responsive behavior at different screen sizes. Verify navigation works correctly and components don't overlap or get cut off.",
        "priority": "medium",
        "dependencies": [
          3,
          4,
          6,
          7,
          9
        ],
        "status": "pending",
        "subtasks": [
          {
            "id": 1,
            "title": "Consolidate and Redesign Application Header",
            "description": "Merge duplicate header elements and create a unified, well-designed application header with proper navigation.",
            "dependencies": [],
            "details": "Remove duplicate header from MainLayout.tsx. Redesign App.tsx header to include: application title/logo, view mode navigation (Sector Map / Factions), primary actions (Generate Sector, Save/Load if available), and user context info. Apply consistent styling using CSS classes instead of inline styles. Ensure proper spacing, typography, and visual hierarchy. Make header responsive and collapsible on smaller screens.\n<info added on 2025-11-24T06:02:33.393Z>\nCompleted implementation of the unified application header. Removed duplicate header from MainLayout.tsx and created AppHeader.css with comprehensive BEM styling. Refactored App.tsx header to use CSS classes and implemented responsive design with a collapsible mobile menu for screens under 768px. Added proper accessibility attributes and ensured all existing functionality including view mode switching and action buttons remains operational.\n</info added on 2025-11-24T06:02:33.393Z>",
            "status": "pending",
            "testStrategy": "Verify header displays correctly in both view modes. Check that navigation buttons work. Test responsive behavior at mobile/tablet widths. Verify no duplicate headers appear."
          },
          {
            "id": 2,
            "title": "Optimize Sector Map View Layout",
            "description": "Reorganize the sector map view for better space utilization and component placement.",
            "dependencies": [
              1
            ],
            "details": "Restructure the sector map view layout. Consider: making the map area more prominent, reorganizing right sidebar components (TurnManager, NewsFeed) for better vertical space usage, adding collapsible/expandable panels, implementing a tabbed interface for sidebar content, or creating a split-panel design. Ensure the map has adequate space and sidebar components don't feel cramped. Improve spacing and padding throughout.\n<info added on 2025-11-24T06:05:13.460Z>\nCompleted optimization of the Sector Map View Layout.\n\nChanges Made:\n1. Created SectorMapView.css with comprehensive layout styles using BEM methodology.\n2. Implemented collapsible sidebar with toggle button that slides in/out smoothly.\n3. Created tabbed interface for TurnManager and NewsFeed allowing users to switch between tabs instead of viewing both stacked.\n4. Improved spacing and padding throughout by removing redundant headers and better using vertical space.\n5. Made map area more prominent so it takes full available width when sidebar is collapsed.\n6. Enhanced responsive design where sidebar adapts to mobile (slides from bottom) and tablet/desktop (slides from right).\n\nKey Features:\n- Collapsible Sidebar: Toggle button allows users to hide/show sidebar to maximize map space.\n- Tabbed Interface: TurnManager and NewsFeed are now in tabs, using vertical space more efficiently.\n- Better Space Utilization: Map area is more prominent, sidebar components no longer feel cramped.\n- Smooth Animations: CSS transitions for sidebar collapse/expand and tab switching.\n- Responsive Breakpoints: Desktop (>1024px) sidebar on right 380px width; Tablet (768px-1024px) sidebar on right 350px width; Mobile (<768px) sidebar slides from bottom taking 50% height.\n\nFiles Modified:\n- src/App.tsx: Refactored sector map view layout with collapsible sidebar and tabs.\n- src/components/SectorMapView.css: New comprehensive layout stylesheet.\n- src/components/TurnManager/TurnManager.css: Updated for tabbed interface.\n- src/components/TurnManager/TurnManager.tsx: Removed duplicate header.\n- src/components/NewsFeed/NewsFeed.css: Updated for tabbed interface.\n</info added on 2025-11-24T06:05:13.460Z>",
            "status": "pending",
            "testStrategy": "Verify map is easily visible and not constrained. Check that TurnManager and NewsFeed are readable and accessible. Test panel collapsing/expanding if implemented. Verify layout works at different window sizes."
          },
          {
            "id": 3,
            "title": "Improve Faction Manager View Layout",
            "description": "Enhance the faction manager view for better organization and usability.",
            "dependencies": [
              1
            ],
            "details": "Review and improve the FactionManager component layout. Consider: better separation between faction creation form and faction list, improved dashboard card layout, better use of horizontal/vertical space, consistent spacing between elements, and clearer visual hierarchy. Ensure faction dashboards are easily scannable and the creation form is prominently placed but doesn't dominate the view.\n<info added on 2025-11-24T06:09:52.351Z>\nCompleted improvement of the Faction Manager View Layout:\n\nChanges Made:\n1. Improved layout structure and spacing - Better grid layout with fixed-width form column (420px) and flexible dashboard area\n2. Enhanced visual separation - Clearer borders, improved header styling with better typography hierarchy\n3. Improved dashboard card layout - Better spacing, hover effects, clearer visual hierarchy with improved borders and backgrounds\n4. Optimized horizontal and vertical space - Better use of available space, improved padding and gaps throughout\n5. Added collapsible form - Form can be collapsed/expanded to maximize dashboard viewing space when not needed\n6. Enhanced scannability - Dashboard cards have better visual separation, hover states, and clearer information hierarchy\n\nKey Features:\n- Collapsible Creation Form: Toggle button allows users to collapse the form to focus on dashboards\n- Better Visual Hierarchy: Improved typography, spacing, and borders create clearer separation between sections\n- Enhanced Dashboard Cards: Better spacing and padding, hover effects for better interactivity, improved borders and backgrounds for visual separation, clearer attribute and resource displays\n- Improved Layout: Fixed-width form column (420px) ensures consistent layout, flexible dashboard area adapts to content\n- Better Spacing: Consistent gaps and padding throughout (1.25rem-1.5rem) for better visual rhythm\n- Responsive Design: Layout adapts to smaller screens with stacked columns\n\nFiles Modified:\n- src/components/FactionManager/FactionManager.tsx - Added collapsible form state and improved structure\n- src/components/FactionManager/FactionManager.css - Comprehensive layout improvements, collapsible form styles, better spacing\n- src/components/FactionManager/FactionCreationForm.tsx - Removed wrapper div (now handled by parent)\n- src/components/FactionManager/FactionDashboard.css - Improved card layout, better spacing, hover effects, clearer hierarchy\n\nThe layout now provides better organization, clearer visual hierarchy, and improved usability with the collapsible form feature.\n</info added on 2025-11-24T06:09:52.351Z>",
            "status": "pending",
            "testStrategy": "Verify faction list and creation form are well-organized. Check that faction dashboards display properly. Test with multiple factions. Verify responsive behavior."
          },
          {
            "id": 4,
            "title": "Implement Responsive Design Improvements",
            "description": "Enhance the layout to work better across different screen sizes and devices.",
            "dependencies": [
              2,
              3
            ],
            "details": "Add responsive breakpoints for mobile, tablet, and desktop views. Implement: collapsible sidebars on smaller screens, stacked layouts for mobile, appropriate font size scaling, touch-friendly button sizes, and navigation adjustments for different screen sizes. Ensure all components remain functional and accessible across breakpoints.\n<info added on 2025-11-24T06:20:05.197Z>\nCompleted comprehensive responsive design improvements across the entire application.\n\nChanges Made:\n1. Created responsive design system: New src/styles/responsive.css with breakpoint variables, touch-friendly sizes, and utility classes.\n2. Enhanced global styles: Updated src/index.css with touch-friendly button sizes and responsive variables.\n3. Improved all component responsive breakpoints: Enhanced existing and added new responsive styles across all components.\n4. Implemented touch-friendly button sizes: All buttons now meet 44px minimum touch target requirement.\n5. Added font size scaling: Responsive typography that scales appropriately for different screen sizes.\n6. Enhanced mobile layouts: Stacked layouts, collapsible sidebars, and optimized spacing for mobile devices.\n7. Improved modal responsiveness: All modals now work well on mobile with full-screen support on small devices.\n\nKey Features:\n- Responsive Breakpoints: Mobile (480px), Tablet (481px-768px), Desktop (769px-1024px), Large (1025px+).\n- Touch-Friendly Design: All interactive elements meet 44px minimum touch target (WCAG 2.1 Level AAA).\n- Collapsible Sidebars: Sidebars automatically collapse or stack on smaller screens.\n- Stacked Layouts: Components stack vertically on mobile for better usability.\n- Font Scaling: Typography scales appropriately for readability across all screen sizes.\n- Modal Improvements: Modals adapt to screen size, becoming full-screen on mobile.\n- Consistent Spacing: Responsive padding and gaps that adjust based on screen size.\n\nFiles Modified:\n- src/styles/responsive.css\n- src/index.css\n- src/main.tsx\n- src/components/AppHeader.css\n- src/components/SectorMapView.css\n- src/components/TurnManager/TurnManager.css\n- src/components/NewsFeed/NewsFeed.css\n- src/components/SaveMenu/SaveMenu.css\n- src/components/FactionManager/FactionManager.css\n- src/components/FactionManager/FactionDashboard.css\n- src/components/FactionManager/FactionCreationForm.css\n- src/components/FactionManager/AssetList.css\n- src/components/FactionManager/AssetCard.css\n- src/components/FactionManager/OwnedAssetItem.css\n- src/components/FactionManager/RepairModal.css\n- src/components/FactionManager/ExpandInfluenceModal.css\n- src/components/Combat/CombatModal.css\n- src/components/Notification.css\n\nResponsive Breakpoints Defined:\n- Mobile (480px): Single column layouts, full-screen modals, stacked components.\n- Tablet (481px-768px): Optimized spacing, collapsible sidebars, touch-friendly targets.\n- Desktop (769px-1024px): Side-by-side layouts, standard spacing.\n- Large (1025px+): Full desktop experience with optimal spacing.\n</info added on 2025-11-24T06:20:05.197Z>",
            "status": "pending",
            "testStrategy": "Test layout at various screen widths (mobile: 320px-768px, tablet: 768px-1024px, desktop: 1024px+). Verify components stack or rearrange appropriately. Check that touch targets are adequate on mobile. Verify text remains readable at all sizes."
          },
          {
            "id": 5,
            "title": "Establish Consistent Spacing and Visual Hierarchy",
            "description": "Create a design system for consistent spacing, typography, and visual hierarchy throughout the application.",
            "dependencies": [
              1,
              2,
              3
            ],
            "details": "Define a spacing scale (using CSS variables or a spacing system). Establish consistent padding/margin values for components. Improve typography hierarchy with consistent heading sizes and weights. Create visual separation between sections using borders, backgrounds, or spacing. Ensure component groupings are visually clear. Apply consistent button styles, card styles, and form element styles throughout.\n<info added on 2025-11-24T06:26:41.569Z>\nCompleted establishment of consistent spacing and visual hierarchy design system.\n\nChanges Made:\n1. Created comprehensive design system in src/styles/design-system.css with complete spacing scale, typography hierarchy, and component styles.\n2. Defined spacing scale using a 4px base unit system (0 to 80px) with semantic variable names (--spacing-1 through --spacing-20).\n3. Established typography hierarchy with consistent heading sizes (h1-h4), font weights, line heights, and letter spacing, including responsive scaling for mobile devices.\n4. Created standardized styles for buttons (primary, secondary, ghost), cards, and form elements.\n5. Applied design system variables to FactionManager component.\n6. Implemented visual separation system using consistent borders, shadows, and background layers.\n7. Added component grouping utilities for standardized spacing.\n\nFiles Modified:\n- src/styles/design-system.css\n- src/main.tsx\n- src/components/FactionManager/FactionManager.css\n</info added on 2025-11-24T06:26:41.569Z>",
            "status": "pending",
            "testStrategy": "Visual inspection of all screens to verify consistent spacing. Check that related elements are grouped visually. Verify typography creates clear hierarchy. Ensure similar components look consistent across views."
          },
          {
            "id": 6,
            "title": "Create Component Layout CSS and Refactor Inline Styles",
            "description": "Move inline styles to CSS classes and create a cohesive layout stylesheet system.",
            "dependencies": [
              2,
              3,
              5
            ],
            "details": "Refactor App.tsx to use CSS classes instead of inline styles. Create layout-specific CSS files (e.g., AppLayout.css, ViewLayout.css) with proper class names. Define reusable layout utilities (e.g., .flex-container, .sidebar, .main-content). Ensure all layout-related styles are in CSS files, not inline. Maintain or improve existing functionality while making styles more maintainable.\n<info added on 2025-11-24T06:30:56.183Z>\nCompleted refactoring of inline styles to CSS classes and established a comprehensive layout system.\n\n**Implementation Results:**\n- Created `src/styles/layout.css` containing reusable layout utilities (flex containers, grid layouts, spacing, overflow, width/height, and alignment utilities).\n- Refactored `App.tsx` to replace inline styles with CSS classes (`.app-container`, `.app-main-content`).\n- Added component-specific stylesheets: `src/components/SectorMap/SectorMap.css` and `src/components/SectorMap/WorldDetails.css`.\n- Updated `SectorMap.tsx` and `WorldDetails.tsx` to import new CSS files and remove inline styles.\n- Defined key layout classes including `.sidebar-layout`, `.grid-container`, and gap/spacing utilities using design system variables.\n- Verified that all existing functionality is preserved while improving code maintainability.\n</info added on 2025-11-24T06:30:56.183Z>",
            "status": "pending",
            "testStrategy": "Verify all styles still work after refactoring. Check that no visual regressions occurred. Verify CSS classes are properly scoped. Test that layout looks identical or improved."
          }
        ]
      },
      {
        "id": 13,
        "title": "Asset Special Features System",
        "description": "Implement a comprehensive system for displaying and managing asset special features (indicated by the 'S' flag), including UI display, feature descriptions, and special cost/bonus logic.",
        "details": "Currently, assets with the 'S' flag (hasSpecial: true) only display a flag indicator without showing what the special features actually are. This task will create a system to define, display, and implement special features for assets. Special features can include special costs, bonuses, restrictions, or unique mechanics that differ from standard asset behavior. The system should be similar to how special actions are handled but focused on passive features, purchase-time effects, and ongoing modifiers.",
        "testStrategy": "Verify that assets with hasSpecial flag display their special features in the UI. Test that special feature logic (costs, bonuses) is applied correctly during purchase and gameplay. Verify that all 37+ assets with special features have appropriate descriptions and implementations.",
        "priority": "medium",
        "dependencies": [
          6,
          11
        ],
        "status": "pending",
        "subtasks": [
          {
            "id": 1,
            "title": "Define Special Features Data Structure and Registry",
            "description": "Create a data structure and registry system to store special feature definitions for assets.",
            "dependencies": [],
            "details": "Create a new utility module `src/utils/assetSpecialFeatures.ts` (or similar). Define a TypeScript interface for special features including: feature type (cost modifier, bonus, restriction, passive effect), description text, and any relevant parameters. Create a registry mapping asset IDs to their special feature definitions. Research the SWN rules to identify what special features each asset with the 'S' flag should have (e.g., special costs, maintenance modifiers, passive bonuses, restrictions).\n<info added on 2025-11-24T06:39:45.751Z>\nCompleted implementation of Special Features Data Structure and Registry. Created src/utils/assetSpecialFeatures.ts containing the SpecialFeatureType enum (11 types), SpecialFeature interface, and a complete specialFeaturesRegistry mapping over 37 assets to their SWN rules. Implemented helper functions including getAssetSpecialFeatures, assetHasSpecialFeatures, getSpecialFeatureDescription, and getSpecialFeaturesByType. Documented features cover cost modifiers, passive bonuses, restrictions, purchase effects, defensive abilities, and unique mechanics for Force, Cunning, and Wealth assets.\n</info added on 2025-11-24T06:39:45.751Z>",
            "status": "done",
            "testStrategy": "Unit test the registry to ensure all assets with hasSpecial flag have corresponding entries. Verify the data structure can handle different types of special features."
          },
          {
            "id": 2,
            "title": "Implement Special Feature Description System",
            "description": "Create functions to retrieve and format special feature descriptions for display in the UI.",
            "dependencies": [
              1
            ],
            "details": "Implement helper functions like `getAssetSpecialFeatures(assetId)` and `getSpecialFeatureDescription(assetId)` that return human-readable descriptions of an asset's special features. Handle cases where an asset has multiple special features. Ensure descriptions are clear and explain both what the feature does and any gameplay implications (costs, bonuses, restrictions).\n<info added on 2025-11-24T06:43:02.054Z>\nCompleted implementation of Special Feature Description System with comprehensive UI-friendly formatting functions.\n\nImplemented Functions:\n\n1. Enhanced Description Functions:\n- getSpecialFeatureDescription(): Returns full formatted description.\n- getSpecialFeatureSummary(): Returns short summary for tooltips/compact displays (configurable max length).\n- formatSpecialFeaturesAsList(): Returns array of formatted feature strings with optional type labels.\n\n2. Grouping and Organization Functions:\n- getSpecialFeaturesByTiming(): Groups features by application timing (purchase, maintenance, combat, etc.).\n- getSpecialFeaturesForDisplay(): Returns structured array of feature objects optimized for HTML/JSX rendering with metadata.\n\n3. Key Information Extraction:\n- getSpecialFeatureKeyInfo(): Extracts gameplay info (cost modifiers, bonuses, restrictions) and generates a summary string.\n\n4. Label Helper Functions:\n- getFeatureTypeLabel(): Converts feature type enum to human-readable label.\n- getFeatureTimingLabel(): Converts timing value to human-readable label.\n\nKey Features:\n- Handles edge cases (missing/multiple features, empty arrays).\n- Returns structured data suitable for React component rendering.\n- Supports configurable length limits for tooltips.\n- Organizes features by timing for UI display.\n- Provides quick reference for gameplay implications.\n\nUse Cases:\n- Tooltips on 'S' flag badge (getSpecialFeatureSummary).\n- Detailed feature display in AssetCard (getSpecialFeaturesForDisplay).\n- Organizing features by timing (getSpecialFeaturesByTiming).\n- Quick reference cards (getSpecialFeatureKeyInfo).\n- Simple list displays (formatSpecialFeaturesAsList).\n\nAll functions are fully typed with TypeScript and ready for UI integration.\n</info added on 2025-11-24T06:43:02.054Z>",
            "status": "done",
            "testStrategy": "Test the description functions with various asset IDs. Verify descriptions are returned correctly and handle edge cases (missing features, multiple features)."
          },
          {
            "id": 3,
            "title": "Update AssetCard Component to Display Special Features",
            "description": "Enhance the AssetCard component to show special feature descriptions when the 'S' flag is present.",
            "dependencies": [
              2
            ],
            "details": "Update `src/components/FactionManager/AssetCard.tsx` to display special features similar to how special actions are displayed. Add a new section that shows when `asset.specialFlags.hasSpecial` is true. Display the feature description(s) in a readable format. Consider adding a tooltip or expandable section for detailed information. Ensure the UI is consistent with the existing special action display pattern.\n<info added on 2025-11-24T06:44:42.809Z>\nCompleted implementation of Special Features display in AssetCard component:\n- Imported `assetHasSpecialFeatures`, `getSpecialFeatureSummary`, and `getSpecialFeaturesForDisplay` from `assetSpecialFeatures.ts`.\n- Enhanced the 'S' flag tooltip to display a concise summary of special features using `getSpecialFeatureSummary()`.\n- Added a new Special Features display section that renders when `asset.specialFlags.hasSpecial` is true, positioned before the Special Action section.\n- Implemented logic to display features in a list format, showing timing labels (e.g., \"On Purchase\") and full descriptions via `getSpecialFeaturesForDisplay()`.\n- Applied CSS styling with a blue color scheme (#3498db) to distinguish from the purple Special Action section, adding classes `.asset-card-special-features`, `.special-features-label`, `.special-feature-item`, and `.special-feature-timing`.\n- Ensured responsive design and visual consistency with existing card patterns.\n</info added on 2025-11-24T06:44:42.809Z>",
            "status": "done",
            "testStrategy": "Visual inspection: Verify that assets with the 'S' flag now show their special features. Test with multiple assets to ensure consistent display. Verify the UI doesn't break for assets without special features."
          },
          {
            "id": 4,
            "title": "Implement Special Feature Logic for Purchase and Gameplay",
            "description": "Add logic to handle special features that affect asset purchase, costs, bonuses, or ongoing gameplay mechanics.",
            "dependencies": [
              1,
              2
            ],
            "details": "Identify which special features require runtime logic (e.g., cost modifiers, passive bonuses, restrictions). Update the asset purchase flow in `factionsSlice.ts` to check for and apply special feature logic. Implement any special cost calculations, bonus applications, or restrictions. Ensure special features are properly applied during purchase and maintained during gameplay. Consider creating a utility function `applySpecialFeatureEffects(assetId, context)` that handles feature-specific logic.\n<info added on 2025-11-24T06:52:10.871Z>\nCompleted implementation of Special Feature Logic for Purchase and Gameplay.\n\n**Implementation Details:**\n\n1. **Utility Module (`src/utils/applySpecialFeatures.ts`):**\n   - Created a comprehensive utility module containing functions to handle various feature types:\n     - `applyPurchaseTimeEffects()`: Handles immediate effects upon purchase.\n     - `getMaintenanceModifier()`: Calculates additional maintenance costs.\n     - `getTechLevelModifier()`: Retrieves tech level modifiers for validation.\n     - `getPurchaseCostModifier()`: Placeholder for future cost modifiers.\n     - `getAssetRestrictions()`: Extracts restriction information.\n     - `applySpecialFeatureEffects()`: Main entry point for applying effects.\n     - `shouldStartStealthed()`: Helper to check if an asset should start stealthed.\n     - `getPassiveBonusIncome()`: Calculates passive income from assets.\n     - `getWorldTechLevelModifier()`: Determines effective tech level based on assets.\n\n2. **Purchase Flow Updates (`factionsSlice.ts`):**\n   - Integrated `applyPurchaseTimeEffects()` into the `addAsset` reducer.\n   - Implemented logic to automatically apply auto-stealth effects (e.g., for Psychic Assassins) and determine final stealthed status.\n\n3. **Maintenance Phase Updates (`factionsSlice.ts`):**\n   - Integrated `getMaintenanceModifier()` into the `processMaintenancePhase` reducer.\n   - Implemented specific additional maintenance cost logic for:\n     - Capital Fleet (+2 FacCreds)\n     - Mercenaries (+1 FacCred)\n     - Pretech Researchers (+1 FacCred)\n     - Scavenger Fleet (+2 FacCreds)\n\n4. **Future Integration Readiness:**\n   - Helper functions are now available for passive bonuses (e.g., Party Machine income), tech level modifiers, and restriction validation, ready to be connected to the income phase, purchase validation, and combat flows respectively.\n</info added on 2025-11-24T06:52:10.871Z>",
            "status": "done",
            "testStrategy": "Test purchasing assets with special features that modify costs. Verify bonuses are applied correctly. Test restrictions are enforced. Verify special features persist correctly in the asset instance."
          },
          {
            "id": 5,
            "title": "Update OwnedAssetItem Component for Special Features Display",
            "description": "Ensure owned assets also display their special features in the faction dashboard.",
            "dependencies": [
              3
            ],
            "details": "Update `src/components/FactionManager/OwnedAssetItem.tsx` to display special features for owned assets. This ensures players can see what special features their assets have after purchase. Consider showing active effects, passive bonuses, or restrictions that are currently in effect. Maintain consistency with the AssetCard display pattern.\n<info added on 2025-11-24T06:54:03.527Z>\nCompleted implementation of Special Features display in OwnedAssetItem component.\n\n**Implementation Details:**\n\n1.  **Logic Integration:**\n    *   Imported `assetHasSpecialFeatures` and `getSpecialFeaturesForDisplay` from `assetSpecialFeatures.ts`.\n    *   Added conditional rendering to only display the section if the asset has special features.\n\n2.  **UI Components:**\n    *   Created a new section positioned after the stealth indicator.\n    *   Uses `getSpecialFeaturesForDisplay()` to render structured feature data.\n    *   Displays features in a list format with timing labels (e.g., \"On Purchase\", \"In Combat\") and full descriptions.\n\n3.  **CSS Styling:**\n    *   Added `.owned-asset-special-features` with a blue background (rgba(52, 152, 219, 0.1)) to match AssetCard styling.\n    *   Implemented specific classes for hierarchy: `.owned-asset-special-features-label`, `.owned-asset-special-features-content`, `.owned-asset-feature-item`, `.owned-asset-feature-timing`, and `.owned-asset-feature-description`.\n    *   Used compact font sizes (0.85rem for items, 0.8rem for labels) to fit the dashboard layout.\n\n**Key Features:**\n*   Visual consistency with the AssetCard display pattern (Blue color scheme #3498db).\n*   Clear visual hierarchy with labeled sections and proper spacing.\n*   Responsive design suitable for the compact OwnedAssetItem layout.\n</info added on 2025-11-24T06:54:03.527Z>",
            "status": "done",
            "testStrategy": "Verify owned assets with special features display them correctly in the faction dashboard. Test that the display is consistent with the purchase view."
          },
          {
            "id": 6,
            "title": "Document All Special Features and Create Tests",
            "description": "Document all special features for assets and create comprehensive tests to ensure correctness.",
            "dependencies": [
              4,
              5
            ],
            "details": "Create comprehensive documentation listing all assets with special features and what each feature does. Write unit tests for the special feature registry, description functions, and logic implementations. Create integration tests to verify special features work correctly in the full purchase and gameplay flow. Ensure all 37+ assets with the 'S' flag have proper implementations and tests.\n<info added on 2025-11-24T07:02:06.789Z>\nCompleted Implementation Details:\n\n1. **Documentation (`.taskmaster/docs/ASSET_SPECIAL_FEATURES.md`):**\n   - Documented all 37+ assets with special features, organized by category (Force, Cunning, Wealth).\n   - Detailed feature types, timings, parameters, and implementation status (Fully/Partially/Pending).\n   - Included references to source files and SWN rules.\n\n2. **Unit Tests (`src/utils/assetSpecialFeatures.test.ts`):**\n   - Implemented 100+ test cases covering registry validation, feature retrieval, description functions, filtering, and formatting.\n   - Verified registry coverage for all assets with the 'hasSpecial' flag.\n   - Handled edge cases (empty arrays, missing features).\n\n3. **Application Logic Tests (`src/utils/applySpecialFeatures.test.ts`):**\n   - Tested purchase-time effects (e.g., Psychic Assassins auto-stealth).\n   - Tested maintenance modifiers (Capital Fleet, Mercenaries, Pretech Researchers, Scavenger Fleet).\n   - Tested tech level modifiers and asset restrictions.\n\n4. **Integration Tests (`src/store/slices/factionsSlice.test.ts`):**\n   - Verified special features within the full Redux purchase and maintenance flows.\n   - Validated credit deduction, state persistence, and combined modifier logic.\n\n**Status:** All tests pass and documentation is complete. System is ready for production.\n</info added on 2025-11-24T07:02:06.789Z>",
            "status": "done",
            "testStrategy": "Run the full test suite to verify all special features are implemented correctly. Manually test a sample of assets with special features to ensure they work as expected in the UI and gameplay."
          }
        ]
      },
      {
        "id": 14,
        "title": "Game Tutorial & Onboarding",
        "description": "Task 14: Game Tutorial & Onboarding System",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement Tutorial Modal Component Structure",
            "description": "Create the reusable modal component with navigation tabs or a stepper interface to house tutorial content.",
            "dependencies": [],
            "details": "Develop a `TutorialModal` component using the project's UI library. The component must support a multi-tab or stepper layout to organize different help topics. Include standard modal features such as a backdrop, a close button, and navigation controls (Next/Previous) for moving between tutorial sections. Ensure the modal is responsive.\n<info added on 2025-11-24T12:58:19.506Z>\nCreated TutorialModal.tsx and TutorialModal.css in src/components/Tutorial/. Implemented a responsive modal with tabbed navigation (Getting Started, Map, Factions, Combat) and Next/Previous controls. Styled using the project's dark theme variables.\n</info added on 2025-11-24T12:58:19.506Z>",
            "status": "done",
            "testStrategy": "Render the modal in isolation (Storybook or unit test) to verify layout, tab switching logic, and close button functionality."
          },
          {
            "id": 2,
            "title": "Author and Implement Getting Started & Map Content",
            "description": "Create the content for the initial tutorial section covering the game objective and map navigation.",
            "dependencies": [
              1
            ],
            "details": "Write and format the text for the 'Getting Started' and 'Sector Map' sections. Explain the hex grid, how to inspect Star Systems, and the winning conditions. Integrate this content into the first tab of the `TutorialModal`. Include placeholders for screenshots if the UI supports image rendering.",
            "status": "done",
            "testStrategy": "Open the modal to the first tab and verify the text renders correctly and is legible against the background."
          },
          {
            "id": 3,
            "title": "Author and Implement Faction, Assets, & Economics Content",
            "description": "Create the tutorial sections explaining Faction management, Asset types, and the Economic cycle.",
            "dependencies": [
              1
            ],
            "details": "Combine the 'Factions & Assets' and 'Turn Cycle & Economics' topics into a cohesive section. Explain FacCreds, the three Asset types (Force, Cunning, Wealth), purchasing logic, maintenance costs, and how the turn cycle updates resources. Add this content to the middle tabs of the modal.",
            "status": "done",
            "testStrategy": "Verify that the Faction and Economics tabs display the correct information and that navigation between this and the previous section works smoothly."
          },
          {
            "id": 4,
            "title": "Author and Implement Combat & Conflict Content",
            "description": "Create the tutorial section detailing combat mechanics, attack rolls, and damage resolution.",
            "dependencies": [
              1
            ],
            "details": "Write the content for the 'Combat & Conflict' section. Detail how assets attack, defense ratings, HP, and the consequences of losing an asset. Explain the specific mechanics of Force vs. Force, Cunning vs. Cunning, and Wealth vs. Wealth conflicts. Implement this as the final content section.",
            "status": "done",
            "testStrategy": "Check the Combat section for clarity and formatting. Ensure no text overflow occurs on smaller screens."
          },
          {
            "id": 5,
            "title": "Integrate Help Button and Toggle Logic",
            "description": "Add the trigger mechanism in the App Header and manage the modal's open/close state.",
            "dependencies": [
              1
            ],
            "details": "Add a 'Help' or '?' icon button to the `AppHeader` component. Implement the state logic (either local React state or Redux UI slice) to toggle the `TutorialModal` visibility when the button is clicked. Ensure the tutorial can be dismissed via the close button or clicking the backdrop.",
            "status": "done",
            "testStrategy": "Click the Help button in the header to confirm the modal opens. Click the close button to confirm it closes. Verify the state persists correctly during the session."
          }
        ]
      },
      {
        "id": 15,
        "title": "Interactive Tutorial Content & Walkthrough",
        "description": "Develop the script, triggers, and interactive steps for the game tutorial to guide players through UI navigation, faction actions, and combat mechanics using the existing Onboarding System.",
        "details": "Using the framework established in Task 14, implement a step-by-step interactive guide that covers the game's core functionality. \n\n1. **UI Tour**: Highlight key areas (Resources, Map, Action Bar) based on the reorganized layout from Task 12.\n2. **Movement & Actions**: Force a context where the player must select a unit and perform Move, Repair, and Expand actions (Task 11).\n3. **Asset Management**: Guide the player to purchase a unit, explaining the cost and Special Feature indicators (Task 13).\n4. **Combat Primer**: Script a mock engagement to explain the Conflict Resolution flow.\n5. **Turn Cycle**: Explain the End Turn mechanic and resource generation.\n\nImplementation involves creating a `TutorialConfig` object that defines the sequence of modals, the DOM elements to highlight, and the Redux state predicates required to advance to the next step.",
        "testStrategy": "Start a new game session with a clean state. Verify the tutorial overlay appears immediately. Follow instructions exactly and verify success states for each step (Move, Repair, Purchase). Attempt to perform invalid actions during a guided step to ensure input blocking works. Verify that the tutorial concludes correctly and sets the `tutorialComplete` flag in the SaveManager.",
        "status": "pending",
        "dependencies": [
          11,
          12,
          13,
          14
        ],
        "priority": "medium",
        "subtasks": []
      }
    ],
    "metadata": {
      "created": "2025-11-23T17:31:41.933Z",
      "updated": "2025-11-24T13:06:53.059Z",
      "description": "Tasks for master context"
    }
  }
}